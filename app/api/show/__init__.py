# -*- coding: utf-8 -*-
import re
from collections import OrderedDict
from datetime import datetime
from flask import Blueprint, render_template, jsonify, request, Response
from flask import Flask, url_for

from neo4j import GraphDatabase
import json
import configparser

from pandas.io.formats import string
import redis

api_show = Blueprint('api_show', __name__)

##æ ¹æ®å…³ç³»åå¾—åˆ°å±æ€§èŠ‚ç‚¹çš„categorieså€¼
dict={
    "has_addr":1,
    "has_age":2,
    "has_bank":3,
    "has_bir":4,
    "has_email":5,
    "has_id":6,
    "has_mar":7,
    "has_name":8,
    "has_sex":9,
    "has_phone":10
}
kind=[
    {
        "name":"å”¯ä¸€æ ‡å¿—ç¬¦"
    },
        {
            "name": "ä¸ªäººä½å€"
        },
        {
            "name": "å¹´é¾„"
        },
        {
            "name": "é“¶è¡Œå¡å·"
        },
        {
            "name": "å‡ºç”Ÿæ—¥æœŸ"
        },
        {
            "name": "é‚®ç®±"
        },
        {
            "name": "èº«ä»½è¯å·"
        },
        {
            "name": "å©šé…æƒ…å†µ"
        },
        {
            "name": "å§“å"
        },
    {
        "name":"æ€§åˆ«"
    },
    {
        "name":"ç”µè¯å·ç "
    }
]


@api_show.route('/metric',methods=['post','GET'])
def get_metric():
    query='MATCH p=()-[r:has]->() RETURN p'
    res=get_metric_result(query)
    print(res)
    return res


@api_show.route('/data', methods=['post', 'GET'])
def get_neo4j_result():
    query = 'match p=(n:UUID)<-->(b) return p limit 1000'
    res = show_neo4j(query)
    return res


##  apiè¿”å›ä¸»æœºèµ„æºä½¿ç”¨æƒ…å†µ
import psutil
import time
# ç”¨äºå­˜å‚¨ä¸Šä¸€æ¬¡è°ƒç”¨çš„ç½‘ç»œæµé‡æ•°æ®
last_net_io = psutil.net_io_counters()
last_time = time.time()
@api_show.route('/table/sysinfo',methods=['post', 'GET'])
def get_system_status():
    global last_net_io, last_time
    current_time = time.time()
    # è·å– CPU ä½¿ç”¨ç‡
    cpu_usage = psutil.cpu_percent(interval=1)
    # è·å–å†…å­˜ä½¿ç”¨ç‡
    memory_info = psutil.virtual_memory()
    memory_usage = memory_info.percent
    # è·å–å½“å‰ç½‘ç»œæµé‡
    current_net_io = psutil.net_io_counters()
    # è®¡ç®—æ—¶é—´é—´éš”
    interval = current_time - last_time
    # è®¡ç®—ç½‘ç»œæµé‡ï¼ˆMB/sï¼‰
    network_traffic = ((current_net_io.bytes_sent + current_net_io.bytes_recv) -
                       (last_net_io.bytes_sent + last_net_io.bytes_recv)) / interval / (1024 * 1024)
    # æ›´æ–° last_net_io å’Œ last_time
    last_net_io = current_net_io
    last_time = current_time

    components = [{
        "name": "ç³»ç»Ÿç»„ä»¶",
        "cpu_usage": cpu_usage,
        "memory_usage": memory_usage,
        "network_traffic": round(network_traffic, 4),
        "timestamp": datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    }]

    data = {
        "components": components
    }
    return jsonify(data)


# api è¿”å›ä»»åŠ¡æ•°æ® ä»¥åŠ æ ·æœ¬æ•°æ®å±•ç¤º
@api_show.route('/datainfo',methods=["POST","GET"])
def get_data_show():
    # å…ˆè·å–æœ€è¿‘çš„å‡ ä¸ªä»»åŠ¡id
    import redis
    from celery_task.config import WORKER_ID_MAP_REDISADDRESS, WORKER_ID_MAP_REDISDBNUM, WORKER_ID_MAP_REDISPASSWORD, \
        WORKER_ID_MAP_REDISPORT
    try:
        # å»ºç«‹åˆ° Redis çš„è¿æ¥
        redis_client = redis.StrictRedis(port=WORKER_ID_MAP_REDISPORT, host=WORKER_ID_MAP_REDISADDRESS,
                                         db=WORKER_ID_MAP_REDISDBNUM, password=WORKER_ID_MAP_REDISPASSWORD)
        # æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ
        redis_client.ping()
        print("Connected to Redis server.")
    except redis.ConnectionError as e:
        # å¤„ç†è¿æ¥é”™è¯¯
        print("Failed to connect to Redis server:", e)
    except Exception as e:
        # å¤„ç†å…¶ä»–å¼‚å¸¸
        print("An error occurred:", e)
    #  è¿æ¥å»ºç«‹åï¼Œæ ¹æ®workeridåˆ¤æ–­æ˜¯å¦å·²å®Œæˆå…¨éƒ¨ä»»åŠ¡
    #  æ”¾åœ¨è°ƒåº¦æ¥å£



#   apiè¿”å›ä»»åŠ¡ç›¸å…³ä¿¡æ¯
@api_show.route('/workerinfo',methods=["POST","GET"])
def get_worker_info():

    from celery_task.config import WORKER_ID_MAP_REDISADDRESS, WORKER_ID_MAP_REDISDBNUM, WORKER_ID_MAP_REDISPASSWORD, \
        WORKER_ID_MAP_REDISPORT
    r=redis.StrictRedis(port=WORKER_ID_MAP_REDISPORT, host=WORKER_ID_MAP_REDISADDRESS,
                             db=WORKER_ID_MAP_REDISDBNUM, password=WORKER_ID_MAP_REDISPASSWORD)
    # ä» Redis è·å–ä»¥ "-0" ç»“å°¾çš„é”®å€¼å¯¹
    # è·å–æœ€è¿‘åˆ›å»ºçš„10ä¸ªä»»åŠ¡çš„worker_id
    zset_key = "tasks"  # å‡è®¾è¿™æ˜¯ zset çš„ key
    latest_task_ids = r.zrevrange(zset_key, 0, 9)  # è·å–åˆ†æ•°æœ€å¤§çš„å‰10ä¸ª

    if not latest_task_ids:
        return jsonify({"error": "No tasks found in Redis"}), 404

    # æ„é€ å“åº”æ•°æ®
    tasks_data = []

    for worker_id in latest_task_ids:
        w=worker_id.decode('utf-8')+'-0'
        task_data = r.get(w)  # æ ¹æ®worker_idè·å–æ•°æ®
        if task_data:
            task_data = json.loads(task_data)

            # æå– `rank` å­—å…¸
            rank_dict = task_data.get("rank", {})

            # å®šä¹‰åˆ†æ•°è¯„ä»·è§„åˆ™
            def get_value(score):
                if score <= 20:
                    return "Very Low"
                elif score <= 40:
                    return "Low"
                elif score <= 60:
                    return "Medium"
                elif score <= 80:
                    return "Good"
                else:
                    return "Excellent"

            # æ„é€  `results`
            results = []
            for key, value in rank_dict.items():
                score = round(value * 100)  # è½¬æ¢ä¸ºç™¾åˆ†åˆ¶
                results.append({
                    "type": key,
                    "rank": score,
                    "value": get_value(score)
                })

            # æ›´æ–°ä»»åŠ¡æ•°æ®
            task_data["results"] = results
            task_data["evaluate"] = "Task successfully evaluated"
            task_data["cost_time"] = "calculated_duration"  # å¯è®¡ç®—å…·ä½“æ—¶é•¿
            tasks_data.append(task_data)

    # è¿”å›æ‰€æœ‰ä»»åŠ¡æ•°æ®
    return jsonify(tasks_data)








# API è¿”å›ä»»åŠ¡æŠ¥å‘Š
@api_show.route('/report_info',methods=["POST","GET"])
def get_report():
    """
        æ ¹æ®ä¸»çº¿ç¨‹ä»»åŠ¡IDè·å–å„ä¸ªå­çº¿ç¨‹çš„ä»»åŠ¡ç»“æœã€‚
        """
    data = request.json
    worker_id = data['Worker_Id']
    import redis
    from celery_task.config import WORKER_ID_MAP_REDISADDRESS, WORKER_ID_MAP_REDISDBNUM, WORKER_ID_MAP_REDISPASSWORD, \
        WORKER_ID_MAP_REDISPORT
    try:
        # å»ºç«‹åˆ° Redis çš„è¿æ¥
        redis_client = redis.StrictRedis(port=WORKER_ID_MAP_REDISPORT, host=WORKER_ID_MAP_REDISADDRESS,
                                         db=WORKER_ID_MAP_REDISDBNUM, password=WORKER_ID_MAP_REDISPASSWORD)
        # æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ
        redis_client.ping()
        print("Connected to Redis server.")
    except redis.ConnectionError as e:
        # å¤„ç†è¿æ¥é”™è¯¯
        print("Failed to connect to Redis server:", e)
    except Exception as e:
        # å¤„ç†å…¶ä»–å¼‚å¸¸
        print("An error occurred:", e)
    #  è¿æ¥å»ºç«‹åï¼Œæ ¹æ®workeridåˆ¤æ–­æ˜¯å¦å·²å®Œæˆå…¨éƒ¨ä»»åŠ¡
    #  æ”¾åœ¨è°ƒåº¦æ¥å£

    #  è¿æ¥å»ºç«‹åï¼Œæ ¹æ®workeridå–æ•°æ®
    try:
        # ä½¿ç”¨ä¸»çº¿ç¨‹IDä½œä¸ºå‰ç¼€ä»Redisä¸­è·å–ä»»åŠ¡ç»“æœ
        keys = redis_client.keys(f'{worker_id}-*')
        # å­˜å‚¨ç»“æœçš„å­—å…¸
        results = {}
        # éå†ç»“æœå¹¶è·å–ä»»åŠ¡ç»“æœ
        for key in keys:
            # æå–å­çº¿ç¨‹ID
            child_process_id = key.decode('utf-8')
            # æ’é™¤åç¼€ä¸º '-0' çš„é”®
            if child_process_id.endswith('-0'):
                continue
            # è·å–å¹¶è§£ç ç»“æœJSON
            result_json = redis_client.get(child_process_id).decode('utf-8')
            result_dict = json.loads(result_json)
            # ä½¿ç”¨å­çº¿ç¨‹IDä½œä¸ºé”®å­˜å‚¨ç»“æœ
            results[child_process_id] = result_dict
        ## æ”¯æŒå¯æ‰©å±•æ€§ï¼Œå°†è¯„ä¼°é€»è¾‘æŒä¹…åŒ–
        report = fillter(replace_keys(results), worker_id)
        return report, 200
    except Exception as e:
        return jsonify({'error': str(e)}), 500

def connect_redis():
    from celery_task.config import WORKER_ID_MAP_REDISADDRESS, WORKER_ID_MAP_REDISDBNUM, WORKER_ID_MAP_REDISPASSWORD, \
        WORKER_ID_MAP_REDISPORT
    return redis.StrictRedis(port=WORKER_ID_MAP_REDISPORT, host=WORKER_ID_MAP_REDISADDRESS,
                                         db=WORKER_ID_MAP_REDISDBNUM, password=WORKER_ID_MAP_REDISPASSWORD)

def replace_keys(raw_data):
    replaced_data = {}
    for key, value in raw_data.items():
        # æ›¿æ¢ key çš„åç¼€
        if key.endswith("-0"):
            worker_id=key-'-0'
            replaced_key = "è¯„ä¼°ä»»åŠ¡çš„ç›¸å…³å‚æ•°"
        elif key.endswith("-1"):
            replaced_key = "é£é™©è¯„ä¼°ç»“æœ"
        elif key.endswith("-2"):
            replaced_key = "åˆè§„æ€§è¯„ä¼°ç»“æœ"
        elif key.endswith("-3"):
            replaced_key = "å¯ç”¨æ€§è¯„ä¼°ç»“æœ"
        elif key.endswith("-4"):
            replaced_key = "åŒ¿åé›†æ•°æ®ç‰¹å¾è¯„ä¼°ç»“æœ"
        elif key.endswith("-5"):
            replaced_key = "åŒ¿åé›†æ•°æ®è´¨é‡è¯„ä¼°ç»“æœ"
        elif key.endswith("-6"):
            replaced_key = "éšç§ä¿æŠ¤æ€§åº¦é‡è¯„ä¼°ç»“æœ"
        else:
            replaced_key = key  # ä¿ç•™å…¶ä»–æœªåŒ¹é…çš„ key

        replaced_data[replaced_key] = value
    return replaced_data

#   fillter è¾…åŠ©å‡½æ•°
##
# ä» Redis è·å–ä»»åŠ¡é…ç½®
def get_task_config(redis_client, worker_id):
    config = redis_client.get(worker_id)
    if config:
        return json.loads(config)  # å°†JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º Python å­—å…¸
    else:
        raise ValueError(f"æœªæ‰¾åˆ°é”®ä¸º {worker_id} çš„ä»»åŠ¡é…ç½®")


def generate_privacy_report(worker_id,report):
    # æœ¬å‡½æ•°å†… worker_idä¼šåŠ '-0'
    # åˆå§‹åŒ– Redis è¿æ¥
    worker_id=worker_id+'-0'
    import redis
    from celery_task.config import WORKER_ID_MAP_REDISADDRESS, WORKER_ID_MAP_REDISDBNUM, WORKER_ID_MAP_REDISPASSWORD, \
        WORKER_ID_MAP_REDISPORT
    redis_client = redis.StrictRedis(port=WORKER_ID_MAP_REDISPORT, host=WORKER_ID_MAP_REDISADDRESS,
                                     db=WORKER_ID_MAP_REDISDBNUM, password=WORKER_ID_MAP_REDISPASSWORD)
    # è·å– worker_id å¯¹åº”çš„å†…å®¹
    try:
        redis_data = redis_client.get(worker_id)
        if not redis_data:
            raise ValueError(f"No data found for worker_id: {worker_id}")
        # å°† Redis çš„æ•°æ®è½¬æ¢ä¸ºå­—å…¸
        data = json.loads(redis_data)
        data=data["evaluate"]
        # å°† Redis æ•°æ®å†™å…¥ report çš„å¯¹åº”ä½ç½®

        print("HHHHHH")
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®ç‰¹å¾"]["è¯„ä¼°ç»“æœ"]=data["æ•°æ®ç‰¹å¾ç»“æœ"]["è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["éšç§é£é™©åº¦é‡"]["è¯„ä¼°ç»“æœ"] = data["éšç§é£é™©åº¦é‡"]["è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["å¯ç”¨æ€§è¯„ä¼°"]["è¯„ä¼°ç»“æœ"] = data["å¯ç”¨æ€§ç»“æœ"]["è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®è´¨é‡è¯„ä¼°"]["è¯„ä¼°ç»“æœ"] = data["æ•°æ®è´¨é‡ç»“æœ"]["è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["éšç§ä¿æŠ¤æ€§åº¦é‡"]["è¯„ä¼°ç»“æœ"] = data["å®‰å…¨æ€§ç»“æœ"]["è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®åˆè§„æ€§"]["è¯„ä¼°ç»“æœ"] = data["åˆè§„æ€§ç»“æœ"]["è¯„ä¼°ç»“æœ"]

        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æŠ¥å‘Šæ‘˜è¦"]["è¯„ä¼°å¾—åˆ†"]=data["è¯„ä¼°å¾—åˆ†"]["rank"]

        return report
    except Exception as e:
        print(f"Error fetching or parsing data from Redis: {e}")
        return None

def fillter(data,worker_id):
    report = {
        "éšç§è¯„ä¼°æŠ¥å‘Š": {
            "è¯„ä¼°ä»»åŠ¡ID":f"{worker_id}",
            "æŠ¥å‘Šæ‘˜è¦": {
                "è¯„ä¼°å¾—åˆ†": {},
                "ç›®çš„": "éšç§ä¿æŠ¤æ•ˆæœè¯„ä¼°æŒ‡æ ‡ä½“ç³»æ˜¯è¯„ä¼°éšç§ä¿æŠ¤æªæ–½çš„æœ‰æ•ˆæ€§çš„é‡è¦å·¥å…·ã€‚ä¸€æ–¹é¢ï¼Œå»ºç«‹éšç§ä¿æŠ¤æ•ˆæœè¯„ä¼°æŒ‡æ ‡ä½“ç³»ï¼Œå¯ä»¥æ”¯æ’‘éšç§ä¿æŠ¤ç­–ç•¥çš„å¤šç»´åº¦é‡åŒ–ä¸è‡ªåŠ¨åŒ–ç­›é€‰ã€‚å¦ä¸€æ–¹é¢ï¼Œé’ˆå¯¹æµ·é‡çš„å¤§æ•°æ®éšç§ä¿¡æ¯ä»¥åŠæ—¶ç©ºåœºæ™¯å…³è”çš„ç‰¹ç‚¹ï¼Œæ•°æ®è„±æ•ä¸ä»…è¦ç¡®ä¿æ•æ„Ÿä¿¡æ¯è¢«å»é™¤ï¼Œè¿˜éœ€å……åˆ†è€ƒè™‘è„±æ•èŠ±è´¹ã€å®é™…ä¸šåŠ¡éœ€æ±‚ç­‰å› ç´ ã€‚æ•°æ®ä¿æŠ¤ä¸æ•°æ®æŒ–æ˜æ˜¯ä¸€å¯¹çŸ›ç›¾ä½“ï¼Œæ—¢è¦ä½¿æ•°æ®æ½œåœ¨ä»·å€¼å¾—åˆ°å……åˆ†åº”ç”¨ï¼Œåˆè¦ç¡®ä¿æ•æ„Ÿä¿¡æ¯ä¸è¢«æ³„éœ²ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œæ•°æ®è„±æ•æ—¶ï¼Œåº”ä¾æ®åœºæ™¯éœ€è¦æ˜ç¡®è„±æ•æ•°æ®èŒƒå›´ã€è„±æ•éœ€æ±‚ä»¥åŠè„±æ•åçš„æ•°æ®ç”¨é€”ã€‚",
                "è¯„ä»·æ ‡å‡†": {
                    "éšç§é£é™©è¯„ä¼°":"éšç§é£é™©è¯„ä¼°æ˜¯æŒ‡",
                    "éšç§ä¿æŠ¤æ€§åº¦é‡": "éšç§ä¿æŠ¤æ€§åº¦é‡æ˜¯æŒ‡éšç§ä¿æŠ¤ç®—æ³•æ‰§è¡Œåï¼Œéšç§ä¿¡æ¯çš„è¢«è¿˜åŸèƒ½åŠ›ã€‚å…·ä½“æ˜¯æŒ‡ï¼šæ”»å‡»è€…/ç¬¬ä¸‰æ–¹ä»æ‰€è§‚æµ‹åˆ°çš„éšç§ä¿¡æ¯åˆ†é‡æ¨æ–­å‡ºéšç§ä¿¡æ¯çš„èƒ½åŠ›ã€‚è‹¥èƒ½å‡†ç¡®æ¨æ–­å‡ºï¼Œåˆ™å®‰å…¨æ€§è¾ƒå·®ï¼Œåä¹‹ï¼Œåˆ™å®‰å…¨æ€§è¾ƒå¥½ã€‚",
                    "éšç§åˆè§„æ€§": "åˆè§„æ€§æ˜¯æŒ‡éšç§ä¿æŠ¤ç®—æ³•æ‰§è¡Œåå¾—åˆ°çš„æ•°æ®æ˜¯å¦ç¬¦åˆè¡Œä¸šæ ‡å‡†ã€å†…éƒ¨è§„ç« åˆ¶åº¦ä»¥åŠå…¶ä»–ç›¸å…³è¦æ±‚çš„èƒ½åŠ›å’ŒçŠ¶æ€ã€‚å…·ä½“æ˜¯æŒ‡ï¼šéšç§ä¿æŠ¤ç®—æ³•æ‰§è¡Œåï¼Œæ•°æ®æ˜¯å¦ç¬¦åˆç›¸å…³è¦æ±‚ä»¥åŠéšç§ä¿æŠ¤ç®—æ³•æ‰€ä¿è¯çš„å®‰å…¨èƒ½åŠ›ï¼Œä»¥æ­¤æ¥ä¿è¯æ•°æ®æœ€åŸºæœ¬çš„å®‰å…¨æ€§ã€‚å¦‚æ»¡è¶³ç›¸å…³è¦æ±‚ï¼Œåˆ™å…·å¤‡åˆè§„æ€§ï¼Œå¦åˆ™ä¸å…·å¤‡åˆè§„æ€§ã€‚",
                    "æ•°æ®å¯ç”¨æ€§": "å¯ç”¨æ€§æ˜¯æŒ‡åŸå§‹æ•°æ®åœ¨ç»è¿‡éšç§ä¿æŠ¤ç®—æ³•ä½œç”¨åå¾—åˆ°çš„æ–°æ•°æ®å¯¹ç³»ç»ŸåŠŸèƒ½æˆ–åˆ†æç ”ç©¶çš„å½±å“ã€‚å…·ä½“æ˜¯æŒ‡ï¼šæ•°æ®ç»è¿‡éšç§ä¿æŠ¤ç®—æ³•ä½œç”¨åï¼ŒåŸå§‹æ•°æ®ä¸éšç§ä¿æŠ¤åæ•°æ®çš„åå·®ã€‚åå·®è¶Šå¤§ï¼Œå¯ç”¨æ€§è¶Šä½ï¼Œåå·®è¶Šå°ï¼Œå¯ç”¨æ€§è¶Šé«˜ã€‚",
                    "æ•°æ®ç‰¹å¾": "æ•°æ®ç‰¹å¾æ˜¯æŒ‡æ•°æ®æœ¬èº«æ‰€å…·æœ‰çš„å±æ€§å’ŒçŠ¶æ€ã€‚å…·ä½“æ˜¯æŒ‡ï¼šæ•°æ®æœ¬èº«å…·å¤‡çš„ä¸€äº›åŸºæœ¬æ€§è´¨å’Œå±æ€§ï¼Œä¸ºæ•°æ®çš„åˆ†æå’Œç³»ç»Ÿåº”ç”¨æä¾›åŸºç¡€ã€‚",
                    "æ•°æ®è´¨é‡è¯„ä¼°": "æ•°æ®è´¨é‡è¯„ä¼°æ˜¯æŒ‡ç»¼åˆè¯„ä¼°éšç§ä¿æŠ¤ç®—æ³•å¯¹æ•°æ®çš„ä½œç”¨å’Œå½±å“ã€‚å…·ä½“æ˜¯æŒ‡ï¼šä»æ•°æ®ç»¼åˆåº”ç”¨çš„è§’åº¦è€ƒè™‘ï¼Œå¯¹ä¿¡æ¯å’Œæ•°æ®è¿›è¡Œå…¨é¢çš„è€ƒå¯Ÿå’Œè¯„ä»·ï¼Œä»è€Œï¼Œæé«˜ä¿¡æ¯å’Œæ•°æ®çš„å¯ä¿¡åº¦å’Œæœ‰æ•ˆåº¦ï¼Œä¸ºå†³ç­–æä¾›æ›´æœ‰åˆ©çš„åŸºç¡€ã€‚"
                }
            },
            "éšç§é£é™©åº¦é‡":{
                "è¯„ä¼°ç»“æœ":{},
            },
            "å¯ç”¨æ€§è¯„ä¼°": {
                "è¯„ä¼°ç»“æœ": {},
            },
            "éšç§ä¿æŠ¤æ€§åº¦é‡": {
                "è¯„ä¼°ç»“æœ": {},
            },
            "æ•°æ®è´¨é‡è¯„ä¼°": {
                "è¯„ä¼°ç»“æœ": {},
            },
            "æ•°æ®åˆè§„æ€§": {
                "è¯„ä¼°ç»“æœ": {},
            },
            "æ•°æ®ç‰¹å¾": {
                "è¯„ä¼°ç»“æœ": {},
            }
        }
    }

    if "é£é™©è¯„ä¼°ç»“æœ" in data:
        item = data["é£é™©è¯„ä¼°ç»“æœ"]
        # "é‡è¯†åˆ«ç‡": risk,
        # "ç»Ÿè®¡æ¨æ–­è¿˜åŸç‡": statistics_risk,
        # "èƒŒæ™¯çŸ¥è¯†æ°´å¹³å‡è®¾": sampling_ratio * j_df.shape[0],
        # "èƒŒæ™¯å±æ€§æ®‹ç¼ºç‡å‡è®¾": nan_ratio,
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["éšç§é£é™©åº¦é‡"] ={
            "æ‘˜è¦": (
                "æœ¬æŒ‡æ ‡æ—¨åœ¨åº¦é‡éšç§é£é™©ï¼Œç‰¹åˆ«æ˜¯åœ¨é­é‡æ”»å‡»æ—¶ï¼Œåˆ†ææ•°æ®è¡¨ä¸­åŒ¿åä¿¡æ¯çš„é‡è¯†åˆ«ä¸ç»Ÿè®¡æ¨æ–­æ”»å‡»é£é™©ã€‚"
                "æ”»å‡»è€…åˆ©ç”¨ä¸€äº›å·²çŸ¥ç”¨æˆ·ä¿¡æ¯ï¼ˆå¦‚å§“åã€èº«ä»½è¯å·ã€æ€§åˆ«ã€å¹´é¾„ã€æ‰‹æœºå·ç­‰ï¼‰è¿›è¡Œæ”»å‡»ï¼Œç›®çš„æ˜¯é‡è¯†åˆ«åŒ¿ååŒ–çš„ç”¨æˆ·æ•°æ®æˆ–è¿›è¡Œç»Ÿè®¡æ¨æ–­ï¼Œä»¥æ¨æµ‹å‡ºç”¨æˆ·çš„ç§äººå±æ€§ã€‚"
            ),
            "æ”»å‡»æ¨¡å‹": {
                "æ€»ä½“æè¿°": "åŸºäºä¸‰ç§æ”»å‡»æ–¹å¼ï¼šé‡è¯†åˆ«æ”»å‡»ã€ç»Ÿè®¡æ¨æ–­æ”»å‡»ä»¥åŠå·®åˆ†æ”»å‡»ã€‚",
                "è¯¦ç»†è¯´æ˜": {
                    "é‡è¯†åˆ«æ”»å‡»": (
                        "æ”»å‡»è€…æ ¹æ®èƒŒæ™¯çŸ¥è¯†ä¸­å·²çŸ¥çš„ç”¨æˆ·ä¿¡æ¯ï¼Œé€‰å–åŒ¿åæ•°æ®è¡¨ä¸­ä¸èƒŒæ™¯çŸ¥è¯†æœ€æ¥è¿‘çš„äº”ä¸ªå€™é€‰é¡¹ï¼Œå¹¶å‡è®¾å€™é€‰çš„ç¬¬ä¸€é¡¹æ•°æ®ä¸ºæ”»å‡»ç»“æœã€‚"
                        "æ”»å‡»æˆåŠŸçš„æ ‡å‡†ä¸ºé€šè¿‡ç›´æ¥æ ‡è¯†ç¬¦ï¼ˆå¦‚ç”¨æˆ·IDï¼‰ç¡®è®¤é‡è¯†åˆ«ç»“æœæ˜¯å¦ä¸èƒŒæ™¯çŸ¥è¯†ä¸€è‡´ã€‚å¦‚æœä¸€è‡´ï¼Œåˆ™è®¤ä¸ºé‡è¯†åˆ«æ”»å‡»æˆåŠŸï¼Œå¦åˆ™æ”»å‡»å¤±è´¥ã€‚"
                    ),
                    "ç»Ÿè®¡æ¨æ–­æ”»å‡»": (
                        "è‹¥é‡è¯†åˆ«æ”»å‡»å¤±è´¥ï¼Œæ”»å‡»è€…å°†è¿›ä¸€æ­¥å¯¹å€™é€‰æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æï¼ŒåŸºäºç»Ÿè®¡ç»“æœæ¨æµ‹ç”¨æˆ·çš„å±æ€§ã€‚"
                        "é€šè¿‡åˆ†æå¤šæ ·æœ¬çš„å±æ€§å…³è”ï¼Œå®ç°å·®åˆ†æ”»å‡»ï¼Œå¹¶é€šè¿‡çŸ¥è¯†å›¾è°±æ•°æ®å±‚ä¸æ•°æ®é›†è¿›è¡Œè¿æ¥ï¼Œç»Ÿè®¡å·®åˆ†æ”»å‡»çš„é‡è¯†åˆ«ç‡ã€‚"
                    ),
                    "å·®åˆ†æ”»å‡»": (
                        "å°†å¤šè¡¨æ•°æ®è¿›è¡Œé“¾æ¥æ”»å‡»ï¼Œä»¥æ­¤æ¥æ¨æ–­åœ¨å¤šåœºæ™¯åŠ¨æ€å‘å¸ƒæ•°æ®æƒ…å†µä¸‹ï¼Œæ•°æ®çš„éšç§æ³„éœ²é£é™©ã€‚"
                    ),
                },
            },
            "èƒŒæ™¯çŸ¥è¯†æ°´å¹³å‡è®¾": (
                f"ä¸ºäº†æ¨¡æ‹Ÿæ”»å‡»è€…çš„èƒŒæ™¯çŸ¥è¯†æ°´å¹³ï¼Œæˆ‘ä»¬å‡è®¾å…¶å¯¹ç”¨æˆ·ä¿¡æ¯çš„äº†è§£ç¨‹åº¦ä¸º {item['èƒŒæ™¯çŸ¥è¯†æ°´å¹³å‡è®¾']}ã€‚"
                "è¿™åæ˜ äº†æ”»å‡»è€…å·²çŸ¥çš„æ ·æœ¬æ•°æ®æ•°é‡ï¼Œæ›´é«˜çš„èƒŒæ™¯çŸ¥è¯†æ°´å¹³ä¼šæé«˜æ”»å‡»æˆåŠŸçš„æ¦‚ç‡ã€‚"
            ),
            "è¯„ä¼°æ–¹æ³•": {
                "é‡è¯†åˆ«ç‡": (
                    "é€šè¿‡æ¨¡æ‹Ÿæ”»å‡»è€…å¯¹åŒ¿ååŒ–æ•°æ®çš„é‡è¯†åˆ«å°è¯•ï¼Œè®¡ç®—é‡è¯†åˆ«æˆåŠŸçš„æ¯”ä¾‹ã€‚"
                    "é‡è¯†åˆ«ç‡çš„é«˜ä½åæ˜ äº†åŒ¿ååŒ–æ•°æ®è¡¨åœ¨ç›´æ¥æ ‡è¯†ç¬¦ä¿æŠ¤ä¸Šçš„å®‰å…¨æ€§ã€‚"
                ),
                "ç»Ÿè®¡æ¨æ–­è¿˜åŸç‡": (
                    "åˆ†æç»Ÿè®¡æ¨æ–­æ”»å‡»ä¸‹ï¼Œæ”»å‡»è€…é€šè¿‡å±æ€§å…³è”æ¨æµ‹æ•æ„Ÿä¿¡æ¯çš„èƒ½åŠ›ï¼Œ"
                    "è¿˜åŸç‡çš„é«˜ä½è¡¨ç¤ºç»Ÿè®¡æ¨æ–­æ”»å‡»çš„æœ‰æ•ˆæ€§ã€‚"
                ),
            },
            "è¯„ä¼°ç»“æœ": {
                "é‡è¯†åˆ«ç‡": item["é‡è¯†åˆ«ç‡"],
                "ç»Ÿè®¡æ¨æ–­è¿˜åŸç‡": item["ç»Ÿè®¡æ¨æ–­è¿˜åŸç‡"],
            },
            "å»ºè®®ä¸æ”¹è¿›æªæ–½": (
                "1. æé«˜åŒ¿ååŒ–æ•°æ®çš„ä¿æŠ¤æ°´å¹³ï¼Œå‡å°‘é‡è¯†åˆ«æˆåŠŸçš„å¯èƒ½æ€§ï¼›\n"
                "2. é’ˆå¯¹å±æ€§å…³è”è¾ƒå¼ºçš„æ•°æ®é›†ï¼Œè¿›è¡Œæ›´ä¸¥æ ¼çš„å»æ ‡è¯†åŒ–å¤„ç†ï¼›\n"
                "3. é€šè¿‡å·®åˆ†éšç§æ–¹æ³•å¢åŠ å™ªå£°ï¼Œé™ä½ç»Ÿè®¡æ¨æ–­æ”»å‡»çš„æœ‰æ•ˆæ€§ï¼›\n"
                "4. å®æ–½åˆ†çº§ç®¡ç†ï¼Œå¯¹æ•°æ®é›†çš„å‘å¸ƒè¿›è¡Œä¸¥æ ¼å®¡æ‰¹ï¼Œä»¥é™ä½å¤šè¡¨é“¾æ¥æ”»å‡»çš„å¯èƒ½æ€§ã€‚"
            )
        }

    # å¯ç”¨æ€§è¯„ä¼°å¡«å……
    if "å¯ç”¨æ€§è¯„ä¼°ç»“æœ" in data:
        item = data["å¯ç”¨æ€§è¯„ä¼°ç»“æœ"]
        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["å¯ç”¨æ€§è¯„ä¼°"] = {
            "æ•°æ®å¯è¾¨åˆ«åº¦": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„å¯è¾¨åˆ«åº¦ã€‚é€šè¿‡è®¡ç®—æ•°æ®å¯è¾¨åˆ«åº¦æŒ‡æ ‡ï¼Œè¡¡é‡éšç§ä¿æŠ¤æªæ–½å¯¹æ•°æ®åŒºåˆ†èƒ½åŠ›çš„å½±å“ã€‚æœ¬æ¬¡è¯„ä¼°çš„ç»“æœæ˜¾ç¤ºæ•°æ®å¯è¾¨åˆ«åº¦ä¸º {item['æ•°æ®å¯è¾¨åˆ«åº¦']}ã€‚",
                "æ•°æ®å¯è¾¨åˆ«åº¦å®šä¹‰": "æ•°æ®å¯è¾¨åˆ«åº¦æ˜¯è¡¡é‡åœ¨åº”ç”¨éšç§ä¿æŠ¤æŠ€æœ¯åï¼Œæ•°æ®è®°å½•ä¹‹é—´ä»èƒ½ä¿æŒåŒºåˆ†èƒ½åŠ›çš„ç¨‹åº¦ã€‚è¾ƒé«˜çš„å¯è¾¨åˆ«åº¦å€¼è¡¨ç¤ºæ•°æ®è®°å½•ä¹‹é—´ä»èƒ½è¾ƒå¥½åœ°åŒºåˆ†ï¼Œè€Œè¾ƒä½çš„å¯è¾¨åˆ«åº¦å€¼åˆ™è¡¨ç¤ºæ•°æ®è®°å½•ä¹‹é—´çš„å·®å¼‚æ€§å‡å°ã€‚å¯¹äºæŸæ¡è®°å½•tï¼Œå¦‚æœå‘å¸ƒçš„æ•°æ®è¡¨ä¸­å­˜åœ¨å¦å¤–sæ¡è®°å½•å’Œtçš„éæ•æ„Ÿå±æ€§ç›¸åŒï¼Œåˆ™tçš„ä¿¡æ¯æŸå¤±è®°ä¸ºsã€‚å¯¹äºåœ¨æ•°æ®è¡¨ä¸­è¢«éšåŒ¿çš„è®°å½•lï¼Œåˆ™lçš„ä¿¡æ¯æŸå¤±ä¸ºåŸå§‹æ•°æ®è¡¨Tä¸­çš„æ‰€æœ‰è®°å½•æ•°ç›®ã€‚",
                "ç»“æœåˆ†æ": {
                    "è¾ƒé«˜çš„å¯è¾¨åˆ«åº¦": f"{item['æ•°æ®å¯è¾¨åˆ«åº¦']} è¿™ä¸€æ•°å€¼ç›¸å¯¹è¾ƒé«˜ï¼Œè¡¨æ˜åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åï¼Œæ•°æ®è®°å½•ä¹‹é—´ä»å…·æœ‰è¾ƒé«˜çš„åŒºåˆ†èƒ½åŠ›ã€‚",
                    "ä¿¡æ¯æŸå¤±æ§åˆ¶": "ä¿¡æ¯æŸå¤±æ€»é‡è¾ƒå°ï¼Œè¡¨æ˜éšç§ä¿æŠ¤æªæ–½æœ‰æ•ˆæ§åˆ¶äº†ä¿¡æ¯ä¸¢å¤±ï¼Œä¿ç•™äº†æ•°æ®çš„è¾¨åˆ«èƒ½åŠ›ã€‚",
                    "ç­‰ä»·ç»„å½±å“": "ç­‰ä»·ç»„çš„å¤§å°å’Œæ•°é‡å¯¹å¯è¾¨åˆ«åº¦æœ‰æ˜¾è‘—å½±å“ï¼Œè¾ƒå°çš„ç­‰ä»·ç»„å’Œè¾ƒå°‘çš„éšåŒ¿è®°å½•æœ‰åŠ©äºæé«˜æ•°æ®çš„å¯è¾¨åˆ«åº¦ã€‚",
                    "ç»“è®º": f"é€šè¿‡è¯„ä¼°å¯è¾¨åˆ«åº¦æŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå½“å‰çš„éšç§ä¿æŠ¤æªæ–½åœ¨ç¡®ä¿éšç§çš„åŒæ—¶ï¼Œè¾ƒå¥½åœ°ä¿ç•™äº†æ•°æ®è®°å½•ä¹‹é—´çš„åŒºåˆ†èƒ½åŠ›ã€‚{item['æ•°æ®å¯è¾¨åˆ«åº¦']} çš„å¯è¾¨åˆ«åº¦å€¼æ˜¾ç¤ºå‡ºæ•°æ®é›†åœ¨ä¿æŠ¤éšç§çš„åŒæ—¶ï¼Œä»ç„¶å…·æœ‰è¾ƒé«˜çš„å®ç”¨æ€§ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "ä¼˜åŒ–ç­‰ä»·ç»„åˆ’åˆ†ï¼šé€šè¿‡è°ƒæ•´ç­‰ä»·ç»„çš„åˆ’åˆ†ç­–ç•¥ï¼Œå‡å°‘ä¿¡æ¯æŸå¤±ã€‚",
                        "æ”¹è¿›éšç§ä¿æŠ¤ç®—æ³•ï¼šé‡‡ç”¨æ›´ä¸ºç²¾ç»†çš„éšç§ä¿æŠ¤ç®—æ³•ï¼Œåœ¨ä¿è¯éšç§çš„å‰æä¸‹ï¼Œæœ€å¤§ç¨‹åº¦ä¿ç•™æ•°æ®çš„å¯è¾¨åˆ«åº¦ã€‚",
                        "æŒç»­ç›‘æ§å’Œè¯„ä¼°ï¼šå®šæœŸè¿›è¡Œå¯è¾¨åˆ«åº¦è¯„ä¼°ï¼ŒåŠæ—¶å‘ç°å’Œæ”¹è¿›éšç§ä¿æŠ¤æªæ–½ä¸­çš„ä¸è¶³ã€‚"
                    ]
                }
            },
            "æ•°æ®è®°å½•åŒ¿åç‡": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„æ•°æ®è®°å½•åŒ¿åç‡ã€‚æ•°æ®è®°å½•åŒ¿åç‡è¡¡é‡æ•°æ®é›†ä¸­è¢«éšè—æˆ–åˆ é™¤çš„è®°å½•æ¯”ä¾‹ã€‚è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®è®°å½•åŒ¿åç‡ä¸º {item['æ•°æ®è®°å½•åŒ¿åç‡']}ã€‚",
                "æ•°æ®è®°å½•åŒ¿åç‡å®šä¹‰": "åœ¨éšç§ä¿æŠ¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰äº›å…ƒç»„ç”±äºä¸ç¬¦åˆéšç§ä¿æŠ¤æ¡ä»¶ä¸€èˆ¬è¿›è¡Œåˆ é™¤èˆå¼ƒï¼Œè¿™æ ·å°±äº§ç”Ÿäº†ä¿¡æ¯ç¼ºå¤±ï¼Œåˆ é™¤çš„è®°å½•ä¸€èˆ¬è¢«ç§°ä¸ºéšåŒ¿è®°å½•ã€‚æ•°æ®è®°å½•åŒ¿åç‡æ˜¯æŒ‡åœ¨éšç§ä¿æŠ¤è¿‡ç¨‹ä¸­ï¼Œè¢«éšè—æˆ–åˆ é™¤çš„è®°å½•æ•°é‡å æ€»è®°å½•æ•°é‡çš„æ¯”ä¾‹ã€‚",
                "ç»“æœåˆ†æ": {
                    "éšåŒ¿è®°å½•æ•°é‡": "è¢«éšåŒ¿çš„è®°å½•æ•° ğ‘›ğ‘ ä¸º 0ï¼Œè¡¨æ˜æ²¡æœ‰è®°å½•è¢«éšè—æˆ–åˆ é™¤ã€‚",
                    "æ•°æ®å®Œæ•´æ€§": "æ•°æ®è®°å½•åŒ¿åç‡ä¸º 0.0% è¡¨ç¤ºæ‰€æœ‰è®°å½•å‡ä¿ç•™ï¼Œæ•°æ®çš„å®Œæ•´æ€§å¾—åˆ°äº†å……åˆ†ä¿éšœã€‚",
                    "ä¿¡æ¯æŸå¤±": "ç”±äºæ²¡æœ‰è®°å½•è¢«éšåŒ¿ï¼Œå› æ­¤ä¸å­˜åœ¨å› éšåŒ¿å¯¼è‡´çš„ä¿¡æ¯æŸå¤±ã€‚",
                    "ç»“è®º": "æ•°æ®è®°å½•åŒ¿åç‡ä¸º 0.0% è¡¨æ˜éšç§ä¿æŠ¤æªæ–½åœ¨ä¸åˆ é™¤ä»»ä½•è®°å½•çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†éšç§ä¿æŠ¤ç›®æ ‡ã€‚è¿™æ„å‘³ç€æ•°æ®çš„å®Œæ•´æ€§å’Œå¯ç”¨æ€§å¾—åˆ°äº†æœ€å¤§ç¨‹åº¦çš„ä¿ç•™ï¼Œéšç§ä¿æŠ¤æŠ€æœ¯çš„åº”ç”¨å¯¹æ•°æ®çš„å®é™…å½±å“æœ€å°ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "æé«˜éšç§ä¿æŠ¤ç²¾åº¦ï¼šåœ¨ä¿è¯æ•°æ®å®Œæ•´æ€§çš„å‰æä¸‹ï¼Œé‡‡ç”¨æ›´ä¸ºå…ˆè¿›çš„éšç§ä¿æŠ¤ç®—æ³•ï¼Œè¿›ä¸€æ­¥é™ä½éšç§æ³„éœ²é£é™©ã€‚",
                        "æŒç»­ç›‘æ§å’Œè¯„ä¼°ï¼šå®šæœŸå¯¹éšç§ä¿æŠ¤æ•ˆæœè¿›è¡Œè¯„ä¼°ï¼Œç¡®ä¿éšç§ä¿æŠ¤æªæ–½æŒç»­æœ‰æ•ˆï¼Œå¹¶åŠæ—¶è°ƒæ•´ç­–ç•¥åº”å¯¹æ–°çš„éšç§é£é™©ã€‚",
                        "ç”¨æˆ·éšç§éœ€æ±‚è°ƒç ”ï¼šäº†è§£ç”¨æˆ·å¯¹éšç§ä¿æŠ¤çš„å…·ä½“éœ€æ±‚å’ŒæœŸæœ›ï¼Œåˆ¶å®šæ›´å…·é’ˆå¯¹æ€§çš„éšç§ä¿æŠ¤æªæ–½ã€‚"
                    ]
                }
            },
            "å¹³å‡æ³›åŒ–ç¨‹åº¦": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„å¹³å‡æ³›åŒ–ç¨‹åº¦ã€‚å¹³å‡æ³›åŒ–ç¨‹åº¦ç”¨äºè¡¡é‡æ•°æ®åœ¨éšç§ä¿æŠ¤è¿‡ç¨‹ä¸­è¢«æ³›åŒ–åçš„å¹³å‡ç­‰ä»·ç»„å¤§å°ã€‚æœ¬æ¬¡è¯„ä¼°çš„ç»“æœæ˜¾ç¤ºï¼Œå¹³å‡æ³›åŒ–ç¨‹åº¦ä¸º {item['å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡']}ã€‚",
                "å¹³å‡æ³›åŒ–ç¨‹åº¦å®šä¹‰": "å¹³å‡æ³›åŒ–ç¨‹åº¦æŒ‡çš„æ˜¯æ•°æ®é›†çš„å…ƒç»„æ€»æ•°é™¤ä»¥æ‰€æœ‰ç­‰ä»·ç»„çš„ä¸ªæ•°ï¼Œè¡¨ç¤ºæ¯ä¸ªç­‰ä»·ç»„ä¸­çš„å¹³å‡è®°å½•æ•°é‡ã€‚é€šè¿‡ç»Ÿè®¡æ•°æ®é›†ä¸­çš„æ€»è®°å½•æ•°ä»¥åŠç­‰ä»·ç»„çš„æ•°é‡ï¼Œè®¡ç®—æ¯ä¸ªç­‰ä»·ç»„çš„å¹³å‡è®°å½•æ•°ï¼Œä»è€Œå¾—å‡ºå¹³å‡æ³›åŒ–ç¨‹åº¦ã€‚è¾ƒé«˜çš„å¹³å‡æ³›åŒ–ç¨‹åº¦å€¼å¯èƒ½æ„å‘³ç€æ›´é«˜çš„éšç§ä¿æŠ¤æ°´å¹³ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´æ•°æ®çš„ç²¾ç¡®æ€§ä¸‹é™ã€‚",
                "ç»“æœåˆ†æ": {
                    "ç­‰ä»·ç»„æ•°é‡": "ç­‰ä»·ç»„çš„ä¸ªæ•° âˆ£ğ¸âˆ£ ç›¸å¯¹è¾ƒå°‘ï¼Œå¯¼è‡´æ¯ä¸ªç­‰ä»·ç»„åŒ…å«æ›´å¤šçš„è®°å½•ã€‚",
                    "éšç§ä¿æŠ¤æ•ˆæœ": "è¾ƒé«˜çš„å¹³å‡æ³›åŒ–ç¨‹åº¦è¡¨æ˜ï¼Œæ•°æ®è®°å½•åœ¨éšç§ä¿æŠ¤è¿‡ç¨‹ä¸­è¢«èšåˆæˆè¾ƒå¤§çš„ç­‰ä»·ç»„ï¼Œè¿™æœ‰åŠ©äºæé«˜éšç§ä¿æŠ¤æ°´å¹³ï¼Œå‡å°‘é‡è¯†åˆ«é£é™©ã€‚",
                    "æ•°æ®å®ç”¨æ€§": "è™½ç„¶è¾ƒé«˜çš„å¹³å‡æ³›åŒ–ç¨‹åº¦æœ‰åŠ©äºä¿æŠ¤éšç§ï¼Œä½†ä¹Ÿå¯èƒ½å¯¼è‡´æ•°æ®çš„ç²¾ç¡®æ€§å’Œå¯ç”¨æ€§ä¸‹é™ï¼Œå½±å“åˆ†æç»“æœçš„ç»†ç²’åº¦ã€‚",
                    "ç»“è®º": "å¹³å‡æ³›åŒ–ç¨‹åº¦ä¸º 189.3939 è¡¨ç¤ºæ•°æ®é›†åœ¨éšç§ä¿æŠ¤è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªç­‰ä»·ç»„å¹³å‡åŒ…å« 189.3939 æ¡è®°å½•ã€‚è¿™ä¸ªå€¼åæ˜ äº†éšç§ä¿æŠ¤æªæ–½å¯¹æ•°æ®è®°å½•çš„èšåˆæ•ˆæœï¼Œè¾ƒé«˜çš„ç­‰ä»·ç»„å¤§å°æœ‰åŠ©äºæé«˜éšç§ä¿æŠ¤æ°´å¹³ï¼Œä½†ä¹Ÿéœ€è¦å¹³è¡¡æ•°æ®çš„å®ç”¨æ€§å’Œç²¾ç¡®æ€§ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "ä¼˜åŒ–ç­‰ä»·ç»„åˆ’åˆ†ç­–ç•¥ï¼šé€šè¿‡æ›´ç»†ç²’åº¦çš„åˆ’åˆ†ç­–ç•¥ï¼Œå‡å°‘ç­‰ä»·ç»„çš„å¤§å°ï¼Œæé«˜æ•°æ®çš„ç²¾ç¡®æ€§ã€‚",
                        "é‡‡ç”¨æ··åˆéšç§ä¿æŠ¤æŠ€æœ¯ï¼šç»“åˆæ³›åŒ–ã€æ‰°åŠ¨ã€æ•°æ®å±è”½ç­‰å¤šç§æŠ€æœ¯ï¼Œæå‡éšç§ä¿æŠ¤æ•ˆæœçš„åŒæ—¶ï¼Œä¿ç•™æ•°æ®çš„å®ç”¨æ€§ã€‚",
                        "åŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤å‚æ•°ï¼šæ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯å’Œæ•°æ®ç‰¹ç‚¹ï¼ŒåŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤å‚æ•°ï¼Œæ‰¾åˆ°éšç§ä¿æŠ¤å’Œæ•°æ®å¯ç”¨æ€§ä¹‹é—´çš„æœ€ä½³å¹³è¡¡ç‚¹ã€‚"
                    ]
                }
            },
            "åŸºäºç†µçš„å¹³å‡æ•°æ®æŸå¤±åº¦": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„åŸºäºç†µçš„æ•°æ®æŸå¤±åº¦ã€‚é€šè¿‡è®¡ç®—éšç§é‡çš„å˜åŒ–ï¼Œè¡¡é‡éšç§ä¿æŠ¤æŠ€æœ¯å¯¹ä¸ªäººä¿¡æ¯å¯è¯†åˆ«æ€§å¢åŠ æ‰€å¸¦æ¥çš„éšç§æŸå¤±ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œå¹³å‡éšç§é™ä½ç¨‹åº¦ä¸º {item['åŸºäºç†µçš„å¹³å‡æ•°æ®æŸå¤±åº¦']}ã€‚",
                "åŸºäºç†µçš„å¹³å‡æ•°æ®æŸå¤±åº¦å®šä¹‰": "åŸºäºç†µçš„å¹³å‡æ•°æ®æŸå¤±åº¦é€šè¿‡è®¡ç®—åˆå§‹éšç§é‡å’Œæ›´æ–°åéšç§é‡çš„å·®å€¼æ¥è¡¡é‡ï¼Œå°†ç°æœ‰ç†µå€¼ / åˆå§‹ç†µï¼Œå³ä¸ºæ•°æ®æŸå¤±åº¦ã€‚è¶Šæ¥è¿‘1ï¼ŒæŸå¤±åº¦è¶Šå¤§ï¼›è¶Šæ¥è¿‘0ï¼ŒæŸå¤±åº¦è¶Šå°ã€‚åˆå§‹ç†µè¡¨ç¤ºåŸå§‹æ•°æ®çš„ç†µå€¼ï¼Œè¡¨ç¤ºåŸæ•°æ®çš„ä¸ç¡®å®šæ€§ï¼›ç°æœ‰ç†µå¹¶éé¦™å†œç†µï¼Œè€Œæ˜¯è¡¨æ˜ç°æœ‰æ•°æ®çš„ä¸ç¡®å®šæ€§ã€‚",
                "ç»“æœåˆ†æ": {
                    "éšç§é™ä½ç¨‹åº¦": "48.43% çš„éšç§é™ä½ç¨‹åº¦è¡¨æ˜ï¼Œéšç§ä¿æŠ¤æŠ€æœ¯å¯¹æ•°æ®é›†çš„å®‰å…¨æ€§æœ‰æ˜¾è‘—å½±å“ï¼Œä½†åŒæ—¶ä¹Ÿå¯¹æ•°æ®å¯ç”¨æ€§æœ‰å½±å“ï¼Œå¯¼è‡´éšç§æŸå¤±æ¥è¿‘ä¸€åŠã€‚",
                    "ç»“è®º": "å¹³å‡éšç§é™ä½ç¨‹åº¦ä¸º48.43% è¡¨æ˜éšç§ä¿æŠ¤æŠ€æœ¯å¯¹æ•°æ®é›†çš„éšç§æ€§æœ‰ä¸€å®šå½±å“ï¼Œä½†æŸå¤±åº¦ç›¸å¯¹è¾ƒä½ï¼Œæ¥è¿‘0ã€‚è¿™è¡¨æ˜éšç§ä¿æŠ¤æªæ–½åœ¨ä¿æŠ¤éšç§çš„åŒæ—¶ï¼Œå°½å¯èƒ½å‡å°‘äº†æ•°æ®çš„æŸå¤±ï¼Œä¿æŒäº†æ•°æ®çš„å®ç”¨æ€§ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "ä¼˜åŒ–æ•°æ®æ³›åŒ–ç­–ç•¥ï¼šé€šè¿‡æ›´ç»†ç²’åº¦çš„æ³›åŒ–ç­–ç•¥ï¼Œå‡å°‘æ•°æ®çš„ä¸ç¡®å®šæ€§ï¼Œæé«˜æ•°æ®çš„ç²¾ç¡®æ€§ã€‚",
                        "æé«˜æ•°æ®åŒ¿ååŒ–æ°´å¹³ï¼šé€šè¿‡æ›´é«˜æ°´å¹³çš„åŒ¿ååŒ–æŠ€æœ¯ï¼Œä¿æŠ¤ä¸ªäººéšç§ä¸è¢«è½»æ˜“è¯†åˆ«ã€‚"
                    ]
                }
            }
        }

    # åˆè§„æ€§æ€§è¯„ä¼°å¡«å……ï¼Œå°±å…ˆè¿™æ ·å§ï¼Œ2024å¹´11æœˆ12æ—¥19:30:28   ä»…åšäº†å¡«å……ï¼Œæœªå¯¹å…¶åˆ†æ
    if "åˆè§„æ€§è¯„ä¼°ç»“æœ" in data:
        item = data["åˆè§„æ€§è¯„ä¼°ç»“æœ"]
        # æå–æœ€åä¸€ä¸ªæ•°å­—çš„é€šç”¨å‡½æ•°
        def extract_last_number(string):
            numbers = re.findall(r'\d+\.?\d*', string)  # åŒ¹é…æ•´æ•°æˆ–å°æ•°
            return numbers[-1] if numbers else None  # å–æœ€åä¸€ä¸ªæ•°å­—

        # æå– K, L, T çš„æœ€åä¸€ä¸ªæ•°å­—
        K_me = extract_last_number(str(item['K-Anonymity']))
        l_value = extract_last_number(str(item['L-Diversity']))
        T_close = extract_last_number(str(item['T-Closeness']))

        # ä»redisä¸­è·å–SAåˆ—å€¼
        redis_client=connect_redis()
        task_config = get_task_config(redis_client, worker_id+'-0')

        # ä»ä»»åŠ¡é…ç½®ä¸­æå–ç›¸å…³å‚æ•°
        sa_columns = task_config["parameters"]["SA"]
        sa_list = ", ".join(sa_columns)

        # æå–(Î±,k)-åŒ¿åæ€§
        AnonymityandLvalue=tuple(map(float, (re.search(r'\((.*?)\)', item['(Î±,k)-Anonymity'][0]).group(1)).split(',')))
        # æå–æ˜¯å¦æ»¡è¶³
        satisfaction_match = re.search(r'(æ»¡è¶³|ä¸æ»¡è¶³)', item['(Î±,k)-Anonymity'][0])
        satisfaction = satisfaction_match.group(1) if satisfaction_match else None

        # è„±æ•ç­–ç•¥æè¿°
        desensitization_strategy = (
            "æœ¬æ¬¡æ•°æ®è„±æ•é‡‡ç”¨äº† K-åŒ¿åæ€§ã€L-å¤šæ ·æ€§ã€(Î±,k)-åŒ¿åæ€§å’Œ T-ç´§å¯†æ€§æŠ€æœ¯çš„ç»¼åˆåº”ç”¨ï¼Œ"
            ""
            "é€šè¿‡åˆ†ç»„ã€éšæœºåŒ–ã€æ³›åŒ–ç­‰æ–¹å¼ï¼Œç¡®ä¿æ•°æ®éšç§æ€§ã€‚"
            "æ ¹æ®åˆè§„æ€§æ£€æµ‹ï¼Œæ•°æ®å¤„ç†ç¬¦åˆ GDPR å’Œã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ä¸­çš„æ•°æ®åŒ¿ååŒ–è¦æ±‚ï¼Œ"
            "ä¿éšœæ•°æ®åœ¨å…±äº«å’Œåˆ†æè¿‡ç¨‹ä¸­çš„å®‰å…¨æ€§ã€‚"
        )

        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®åˆè§„æ€§"] = {
            "è„±æ•ç­–ç•¥åˆè§„æ€§ç»¼è¿°": {
                "æŠ€æœ¯æè¿°": desensitization_strategy,
                "åˆè§„æ€§æ£€æµ‹": "å·²é€šè¿‡å†…éƒ¨åˆè§„æ€§æ£€æµ‹ï¼Œç¬¦åˆ GDPR ç¬¬ 25 æ¡ä¸­å…³äºæ•°æ®ä¿æŠ¤çš„è®¾è®¡è¦æ±‚ï¼Œä»¥åŠã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ä¸­å¯¹äºåŒ¿ååŒ–å¤„ç†çš„è§„èŒƒã€‚",
            },
            "K-Anonymity": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†çš„ K-åŒ¿åæ€§ï¼Œç‰¹åˆ«å…³æ³¨æ˜¯å¦æ»¡è¶³ 2-åŒ¿åæ€§è¦æ±‚ã€‚K-åŒ¿åæ€§æ˜¯æŒ‡æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« K ä¸ªè®°å½•ï¼Œä»è€Œä¿è¯æ•°æ®çš„åŒ¿åæ€§å’Œéšç§ä¿æŠ¤ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†{item['K-Anonymity']}ã€‚",
                "K-Anonymityå®šä¹‰": "K-åŒ¿åæ€§æ˜¯æŒ‡æ•°æ®é›†è¢«åˆ’åˆ†ä¸ºå¤šä¸ªç­‰ä»·ç±»ï¼Œæ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« K ä¸ªè®°å½•ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é›†æ»¡è¶³ K-åŒ¿åæ€§ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•ä¸€ä¸ªè®°å½•ï¼Œè‡³å°‘æœ‰ K - 1 ä¸ªå…¶ä»–è®°å½•å…·æœ‰ç›¸åŒçš„å‡†æ ‡è¯†ç¬¦å€¼ã€‚",
                "ç»“æœåˆ†æ": f"æ ¹æ®è¯„ä¼°ç»“æœï¼Œæ•°æ®é›†{item['K-Anonymity']}ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« {K_me} ä¸ªè®°å½•ï¼Œä»è€Œä¿è¯äº†æ•°æ®çš„åŒ¿åæ€§å’Œéšç§ä¿æŠ¤ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    f"æé«˜åŒ¿åçº§åˆ«ï¼šå¦‚æœæ•°æ®é›†ä¸­çš„éšç§é£é™©è¾ƒé«˜ï¼Œå¯ä»¥è€ƒè™‘æé«˜ K å€¼ï¼Œä¾‹å¦‚å®ç° {int(K_me) + 1}-åŒ¿åæˆ–æ›´é«˜çš„åŒ¿åæ€§ã€‚",
                    "ä¼˜åŒ–ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼šé€šè¿‡æ›´åˆç†çš„ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªç­‰ä»·ç±»ä¸­çš„è®°å½•æ•°é‡æ›´åŠ å‡è¡¡ï¼Œè¿›ä¸€æ­¥é™ä½é‡è¯†åˆ«æ”»å‡»çš„é£é™©ã€‚"
                ],
                "åˆè§„æ€§è¦æ±‚": "æ•°æ®å¤„ç†ç¬¦åˆ GDPR ç¬¬ 5 æ¡å…³äºæ•°æ®æœ€å°åŒ–åŸåˆ™çš„è¦æ±‚ï¼Œç¡®ä¿éšç§é£é™©å¯æ§ã€‚"
            },
            "L-Diversity": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒéšç§å±æ€§çš„ L-å¤šæ ·æ€§ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ {sa_list} æ˜¯å¦æ»¡è¶³ {l_value}-å¤šæ ·æ€§è¦æ±‚ã€‚"
                            f"L-å¤šæ ·æ€§æ˜¯ä¸€ç§å¢å¼ºçš„éšç§ä¿æŠ¤æ–¹æ³•ï¼Œé€šè¿‡ç¡®ä¿æ¯ä¸ªç­‰ä»·ç±»ä¸­åŒ…å«è‡³å°‘ L ä¸ªä¸åŒçš„æ•æ„Ÿå€¼ï¼Œä»è€Œå¢å¼ºæ•°æ®çš„éšç§ä¿æŠ¤ã€‚",
                "L-Diversityå®šä¹‰": "L-å¤šæ ·æ€§æ˜¯æŒ‡æ¯ä¸ªç­‰ä»·ç±»ä¸­åŒ…å«è‡³å°‘ L ä¸ªä¸åŒçš„æ•æ„Ÿå€¼ã€‚å…·ä½“æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®é›†æ»¡è¶³ L-å¤šæ ·æ€§ï¼Œé‚£ä¹ˆå¯¹äºä»»ä½•ä¸€ä¸ªç­‰ä»·ç±»ï¼Œè‡³å°‘åŒ…å« L ä¸ªä¸åŒçš„æ•æ„Ÿå€¼ã€‚",
                "ç»“æœåˆ†æ": f"è¿™äº›ç»“æœè¡¨æ˜ï¼Œå±æ€§ {sa_list} åœ¨éšç§ä¿æŠ¤æªæ–½åº”ç”¨åï¼Œå‡æ»¡è¶³ {l_value}-å¤šæ ·æ€§ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« {l_value} ä¸ªä¸åŒçš„æ•æ„Ÿå€¼ï¼Œä»è€Œå¢å¼ºäº†æ•°æ®çš„éšç§ä¿æŠ¤ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    f"æé«˜å¤šæ ·æ€§çº§åˆ«ï¼šå¦‚æœæ•°æ®é›†ä¸­çš„éšç§é£é™©è¾ƒé«˜ï¼Œå¯ä»¥è€ƒè™‘æé«˜ L å€¼ï¼Œä¾‹å¦‚å®ç° {int(l_value) + 1}-å¤šæ ·æ€§æˆ–æ›´é«˜çš„å¤šæ ·æ€§ã€‚",
                    "ä¼˜åŒ–ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼šé€šè¿‡æ›´åˆç†çš„ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªç­‰ä»·ç±»ä¸­çš„æ•æ„Ÿå€¼æ›´åŠ å¤šæ ·åŒ–ï¼Œè¿›ä¸€æ­¥é™ä½éšç§æ³„éœ²é£é™©ã€‚",
                    "åŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®å‘å¸ƒåçš„å®é™…ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤æªæ–½ï¼Œä»¥åº”å¯¹æ½œåœ¨çš„éšç§æ³„éœ²é£é™©ã€‚"
                ],
                "åˆè§„æ€§è¦æ±‚": "å·²é€šè¿‡åˆè§„æ€§æ£€æµ‹ï¼Œç¬¦åˆ GDPR å’Œã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ä¸­å…³äºæ•æ„Ÿå±æ€§åŒ¿ååŒ–çš„è¦æ±‚ã€‚"
            },
            "(Î±,k)-åŒ¿åæ€§": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†çš„ (Î±,k)-åŒ¿åæ€§ï¼Œç‰¹åˆ«å…³æ³¨éšç§å±æ€§ {sa_list} æ˜¯å¦æ»¡è¶³ ({AnonymityandLvalue[0]},{AnonymityandLvalue[1]})-åŒ¿åæ€§è¦æ±‚ã€‚(Î±,k)-åŒ¿åæ€§æ˜¯ä¸€ç§å¢å¼ºçš„éšç§ä¿æŠ¤æ–¹æ³•ï¼Œé€šè¿‡ç¡®ä¿æ¯ä¸ªç­‰ä»·ç±»ä¸­ï¼Œæ•æ„Ÿå±æ€§çš„é¢‘ç‡ä¸è¶…è¿‡æ€»è®°å½•æ•°çš„ Î± å€ï¼Œä¸”æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« k ä¸ªè®°å½•ï¼Œä»è€Œå¢å¼ºæ•°æ®çš„éšç§ä¿æŠ¤ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œéšç§å±æ€§ day_startã€day_end å’Œ hotel_name å‡æ»¡è¶³ ({AnonymityandLvalue[0]},{AnonymityandLvalue[1]})-åŒ¿åæ€§ã€‚",
                "(Î±,k)-åŒ¿åæ€§å®šä¹‰": f"(Î±,k)-åŒ¿åæ€§æ˜¯æŒ‡æ¯ä¸ªç­‰ä»·ç±»ä¸­ï¼Œæ•æ„Ÿå±æ€§çš„é¢‘ç‡ä¸è¶…è¿‡æ€»è®°å½•æ•°çš„ Î± å€ï¼Œä¸”æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« k ä¸ªè®°å½•ã€‚",
                "ç»“æœåˆ†æ": f"è¿™äº›ç»“æœè¡¨æ˜ï¼Œéšç§å±æ€§ {sa_list} åœ¨éšç§ä¿æŠ¤æªæ–½åº”ç”¨åï¼Œ{satisfaction} ({AnonymityandLvalue[0]},{AnonymityandLvalue[1]})-åŒ¿åæ€§ã€‚è¿™æ„å‘³ç€æ¯ä¸ªç­‰ä»·ç±»ä¸­è‡³å°‘åŒ…å« {AnonymityandLvalue[1]} ä¸ªè®°å½•ï¼Œä¸”æ•æ„Ÿå±æ€§çš„é¢‘ç‡ä¸è¶…è¿‡æ€»è®°å½•æ•°çš„ {AnonymityandLvalue[0]} å€ï¼Œä»è€Œå¢å¼ºäº†æ•°æ®çš„éšç§ä¿æŠ¤ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    f"æé«˜åŒ¿åçº§åˆ«ï¼šå¦‚æœæ•°æ®é›†ä¸­çš„éšç§é£é™©è¾ƒé«˜ï¼Œå¯ä»¥è€ƒè™‘æé«˜ k å€¼å’Œé™ä½ Î± å€¼ï¼Œä¾‹å¦‚å®ç° ({float(AnonymityandLvalue[0])/2},{AnonymityandLvalue[1]+1})-åŒ¿åæˆ–æ›´é«˜çš„åŒ¿åæ€§ã€‚",
                    "é¢‘ç‡é™åˆ¶ï¼šå¯¹ç­‰ä»·ç±»ä¸­çš„æ•æ„Ÿå±æ€§é¢‘ç‡è¿›è¡Œé™åˆ¶ï¼Œç¡®ä¿å…¶ä¸è¶…è¿‡ Î± å€çš„æ€»è®°å½•æ•°ã€‚",
                    "åˆ†å¸ƒä¼˜åŒ–ï¼šè°ƒæ•´ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼Œä¼˜åŒ–æ•æ„Ÿå±æ€§çš„é¢‘ç‡åˆ†å¸ƒï¼Œå¢å¼ºåŒ¿åæ€§æ•ˆæœã€‚"
                ],
                "åˆè§„æ€§è¦æ±‚": "æ•°æ®å¤„ç†ç¬¦åˆ GDPR ä¸­çš„éšç§ä¿æŠ¤è®¾è®¡åŸåˆ™ï¼ŒåŒæ—¶æ»¡è¶³è¡Œä¸šå†…å¸¸è§çš„æ•°æ®åŒ¿ååŒ–æ ‡å‡†ã€‚"
            },
            "T-Closeness": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒéšç§å±æ€§çš„ T-ç´§å¯†æ€§ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ day_startã€day_end å’Œ hotel_nameæ˜¯å¦æ»¡è¶³ {T_close}-ç´§å¯†æ€§è¦æ±‚ã€‚T-ç´§å¯†æ€§æ˜¯ä¸€ç§å¢å¼ºçš„éšç§ä¿æŠ¤æ–¹æ³•ï¼Œé€šè¿‡ç¡®ä¿æ•æ„Ÿå±æ€§çš„åˆ†å¸ƒåœ¨ç­‰ä»·ç±»å’Œæ•´ä¸ªæ•°æ®é›†ä¹‹é—´çš„å·®å¼‚ä¸è¶…è¿‡æŸä¸€é˜ˆå€¼ï¼Œä»è€Œå¢å¼ºæ•°æ®çš„éšç§ä¿æŠ¤ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œç­‰ä»·ç»„ ('ç”·', '50-100', '43****************', '14********') çš„éšç§å±æ€§ day_start å’Œ day_end ä¸æ»¡è¶³ 0.95-ç´§å¯†æ€§ï¼Œè€Œéšç§å±æ€§ hotel_name æ»¡è¶³ 0.95-ç´§å¯†æ€§ã€‚",
                "T-Closenesså®šä¹‰": f"T-ç´§å¯†æ€§æ˜¯æŒ‡æ•æ„Ÿå±æ€§çš„åˆ†å¸ƒåœ¨ç­‰ä»·ç±»å’Œæ•´ä¸ªæ•°æ®é›†ä¹‹é—´çš„å·®å¼‚ä¸è¶…è¿‡æŸä¸€é˜ˆå€¼tã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªç­‰ä»·ç±»å’Œæ•æ„Ÿå±æ€§ï¼Œå¦‚æœæ•æ„Ÿå±æ€§åœ¨ç­‰ä»·ç±»ä¸­çš„åˆ†å¸ƒå’Œåœ¨æ•´ä¸ªæ•°æ®é›†ä¸­çš„åˆ†å¸ƒä¹‹é—´çš„è·ç¦»ä¸è¶…è¿‡é˜ˆå€¼tï¼Œåˆ™è¯¥ç­‰ä»·ç±»æ»¡è¶³ T-ç´§å¯†æ€§ã€‚",
                "ç»“æœåˆ†æ": f"{item['T-Closeness'][0]}ã€‚T-ç´§å¯†æ€§ä¸è¶³è¡¨ç¤ºæ•æ„Ÿå±æ€§åœ¨ç­‰ä»·ç±»å’Œæ•´ä¸ªæ•°æ®é›†ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚è¾ƒå¤§ï¼Œå­˜åœ¨è¾ƒé«˜çš„éšç§æ³„éœ²é£é™©ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå‡å°‘æ•æ„Ÿå±æ€§åœ¨ç­‰ä»·ç±»å’Œæ•´ä¸ªæ•°æ®é›†ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚",
                    "åˆ†å¸ƒå¯¹é½ï¼šä¼˜åŒ–ç­‰ä»·ç±»åˆ’åˆ†ï¼Œä½¿æ•æ„Ÿå±æ€§çš„åˆ†å¸ƒå°½å¯èƒ½æ¥è¿‘å…¨å±€åˆ†å¸ƒã€‚",
                    "åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®éšç§éœ€æ±‚åŠ¨æ€è°ƒæ•´ç´§å¯†æ€§é˜ˆå€¼ï¼Œé™ä½éšç§æ³„éœ²é£é™©ã€‚"
                ],
                "åˆè§„æ€§è¦æ±‚": "å·²é€šè¿‡åˆè§„æ€§æ£€æµ‹ï¼Œç¬¦åˆ GDPR å’Œã€Šä¸ªäººä¿¡æ¯ä¿æŠ¤æ³•ã€‹ä¸­å¯¹æ•æ„Ÿå±æ€§åˆ†å¸ƒå·®å¼‚çš„é™åˆ¶è¦æ±‚ã€‚"
            }
        }

    # æ•°æ®è´¨é‡è¯„ä¼°å¡«å……
    if "åŒ¿åé›†æ•°æ®è´¨é‡è¯„ä¼°ç»“æœ" in data:
        item = data["åŒ¿åé›†æ•°æ®è´¨é‡è¯„ä¼°ç»“æœ"]

        # ä»redisä¸­è·å–SAåˆ—å€¼
        redis_client = connect_redis()
        task_config = get_task_config(redis_client, worker_id + '-0')

        # ä»ä»»åŠ¡é…ç½®ä¸­æå–ç›¸å…³å‚æ•° SA
        sa_columns = task_config["parameters"]["SA"]
        sa_list = ", ".join(sa_columns)

        # åˆå¹¶åˆ—è¡¨å…ƒç´ ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²
        distribution_leakage_list = item["åˆ†å¸ƒæ³„éœ²"]
        combined_string = " ".join(distribution_leakage_list)  # ç”¨ç©ºæ ¼åˆå¹¶ï¼Œä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–åˆ†éš”ç¬¦

        distribution_leakage_list = item["ç†µæ³„éœ²"]
        shangxielou_string = " ".join(distribution_leakage_list)  # ç”¨ç©ºæ ¼åˆå¹¶ï¼Œä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–åˆ†éš”ç¬¦

        distribution_leakage_list = item["æ­£é¢ä¿¡æ¯æŠ«éœ²"]
        zhengmian_string = " ".join(distribution_leakage_list)  # ç”¨ç©ºæ ¼åˆå¹¶ï¼Œä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–åˆ†éš”ç¬¦

        distribution_leakage_list = item["KL_Divergence"]
        sandu_string = " ".join(distribution_leakage_list)  # ç”¨ç©ºæ ¼åˆå¹¶ï¼Œä¹Ÿå¯ä»¥æ”¹æˆå…¶ä»–åˆ†éš”ç¬¦

        report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®è´¨é‡è¯„ä¼°"] ={
            "åˆ†å¸ƒæ³„éœ²": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒå±æ€§çš„åˆ†å¸ƒæ³„éœ²ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ {sa_list}ã€‚é€šè¿‡è®¡ç®—æ¬§å‡ é‡Œå¾—è·ç¦»ï¼Œè¯„ä¼°è¿™äº›å±æ€§åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨ååˆ†å¸ƒçš„å˜åŒ–æƒ…å†µã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œ {combined_string}ã€‚",
                "åˆ†å¸ƒæ³„éœ²å®šä¹‰": f"å¯¹äºæŸä¸€ä¸ªæ•æ„Ÿå±æ€§ï¼Œç¡®å®šæŸä¸ªç­‰ä»·ç»„å’ŒåŸå§‹æ•°æ®åœ¨å‘å¸ƒå‰å’Œå‘å¸ƒåçš„æ¦‚ç‡åˆ†å¸ƒï¼Œè®¡ç®—ä¸¤è€…ä¹‹é—´çš„æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚åˆ†å¸ƒæ³„æ¼å¯ä»¥çœ‹ä½œæ˜¯å±æ€§å€¼åˆ†å¸ƒä»ä¸€ç§çŠ¶æ€åˆ°å¦ä¸€ç§çŠ¶æ€çš„æ€»ä½“å‘æ•£åº¦çš„åº¦é‡ã€‚å¯¹äºæ¯ä¸ªç»™å®šçš„ç­‰ä»·ç±»ï¼Œæµ‹é‡åŸå§‹æ•°æ®é›†å’Œå·²å‘å¸ƒæ•°æ®é›†ä¸­æ•æ„Ÿå±æ€§å€¼çš„åŸå§‹åˆ†å¸ƒä¹‹é—´çš„æ³„æ¼ã€‚",
                "ç»“æœåˆ†æ": f"è¯„ä¼°ç»“æœè¡¨æ˜ï¼Œ{combined_string}ï¼ŒXXX",
                "ç»“è®º": f"åˆ†å¸ƒæ³„éœ²çš„è®¡ç®—ç»“æœè¡¨æ˜ï¼Œ{combined_string}ã€‚ä¿æŒåˆ†å¸ƒçš„ä¸€è‡´æ€§æ˜¯éšç§ä¿æŠ¤æŠ€æœ¯çš„ç›®æ ‡ä¹‹ä¸€ï¼Œè¾ƒå°çš„åˆ†å¸ƒæ³„éœ²å€¼è¡¨æ˜æ•°æ®å‘å¸ƒåçš„éšç§æ³„éœ²é£é™©è¾ƒä½ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå‡å°‘åŸå§‹æ•°æ®ä¸å‘å¸ƒæ•°æ®ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚",
                    "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œä¿æŒæ•°æ®åˆ†å¸ƒçš„ä¸€è‡´æ€§ï¼Œå‡å°‘åˆ†å¸ƒæ³„éœ²ã€‚",
                    "åŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»çš„åˆ’åˆ†ç­–ç•¥ï¼Œå‡å°‘åˆ†å¸ƒæ³„éœ²é£é™©ã€‚"
                ]
            },
            "ç†µæ³„éœ²": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒå±æ€§çš„ç†µæ³„éœ²ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ {sa_list}ã€‚é€šè¿‡è®¡ç®—ç†µæ³„éœ²ï¼Œè¯„ä¼°è¿™äº›å±æ€§åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨ååˆ†å¸ƒå˜åŒ–å¸¦æ¥çš„éšç§æ³„éœ²æƒ…å†µã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œ{shangxielou_string}",
                "ç†µæ³„éœ²å®šä¹‰": f"å¯¹äºæŸä¸€ä¸ªæ•æ„Ÿå±æ€§ï¼Œç¡®å®šæŸä¸ªç­‰ä»·ç»„å’ŒåŸå§‹æ•°æ®åœ¨å‘å¸ƒå‰å’Œå‘å¸ƒåçš„æ¦‚ç‡åˆ†å¸ƒï¼Œåˆå§‹åˆ†å¸ƒå’Œå‘å¸ƒåˆ†å¸ƒä¹‹é—´çš„ç†µå·®å¼‚ã€‚",
                "ç»“æœåˆ†æ": f"è¿™äº›ç»“æœè¡¨æ˜ï¼Œ{shangxielou_string}ç†µæ³„éœ²å€¼è¶Šé«˜ï¼Œè¡¨ç¤ºåŸå§‹åˆ†å¸ƒä¸å‘å¸ƒåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚è¶Šå¤§ï¼Œéšç§æ³„éœ²é£é™©è¶Šé«˜ã€‚",
                "ç»“è®º": f"ç†µæ³„éœ²çš„è®¡ç®—ç»“æœè¡¨æ˜ï¼Œ{shangxielou_string}ã€‚ä¿æŒåˆ†å¸ƒçš„ä¸€è‡´æ€§æ˜¯éšç§ä¿æŠ¤æŠ€æœ¯çš„ç›®æ ‡ä¹‹ä¸€ï¼Œè¾ƒé«˜çš„ç†µæ³„éœ²å€¼è¡¨æ˜æ•°æ®å‘å¸ƒåçš„éšç§æ³„éœ²é£é™©è¾ƒé«˜ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå‡å°‘åŸå§‹æ•°æ®ä¸å‘å¸ƒæ•°æ®ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚",
                    "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œä¿æŒæ•°æ®åˆ†å¸ƒçš„ä¸€è‡´æ€§ï¼Œå‡å°‘ç†µæ³„éœ²ã€‚",
                    "åŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»çš„åˆ’åˆ†ç­–ç•¥ï¼Œå‡å°‘åˆ†å¸ƒæ³„éœ²é£é™©ã€‚"
                ]
            },
            "æ­£é¢ä¿¡æ¯æŠ«éœ²": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒå±æ€§çš„æ­£é¢ä¿¡æ¯æŠ«éœ²ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ {sa_list}ã€‚é€šè¿‡è®¡ç®—æ­£é¢ä¿¡æ¯æŠ«éœ²é‡ï¼Œè¯„ä¼°è¿™äº›å±æ€§åœ¨éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åï¼Œå…¬å¼€ä¿¡æ¯å¯èƒ½å¸¦æ¥çš„éšç§æ³„éœ²é£é™©ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œ{zhengmian_string}",
                "æ­£é¢ä¿¡æ¯æŠ«éœ²å®šä¹‰": f"æ­£é¢ä¿¡æ¯æŠ«éœ²é‡è¡¡é‡çš„æ˜¯å‘å¸ƒä¿¡æ¯å¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²çš„æ¦‚ç‡å¢åŠ é‡ã€‚",
                "ç»“æœåˆ†æ": f"è¿™äº›ç»“æœè¡¨æ˜ï¼Œ{zhengmian_string}",
                "ç»“è®º": f"æ­£é¢ä¿¡æ¯æŠ«éœ²çš„è®¡ç®—ç»“æœè¡¨æ˜ï¼Œ{zhengmian_string}ï¼Œä»éœ€å…³æ³¨å…¶æ½œåœ¨çš„éšç§é£é™©ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå‡å°‘å‘å¸ƒä¿¡æ¯ä¸æ•æ„Ÿä¿¡æ¯ä¹‹é—´çš„å…³è”æ€§ã€‚",
                    "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œæ§åˆ¶æ­£é¢ä¿¡æ¯æŠ«éœ²é‡ï¼Œå‡å°‘éšç§æ³„éœ²é£é™©ã€‚",
                    "åŠ¨æ€è°ƒæ•´å‘å¸ƒä¿¡æ¯ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´å‘å¸ƒä¿¡æ¯çš„å†…å®¹å’Œæ–¹å¼ï¼Œå‡å°‘æ­£é¢ä¿¡æ¯æŠ«éœ²é£é™©ã€‚"
                ]
            },
            "KL-Divergence": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­ä¸åŒå±æ€§çš„ Kullback-Leibler (KL) æ•£åº¦ï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ {sa_list}ã€‚KL æ•£åº¦ç”¨äºè¡¡é‡ä¸¤ä¸ªé¢‘ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œè¡¨ç¤ºä½¿ç”¨æ•´ä¸ªæ•°æ®é›†ä¸­æ•æ„Ÿå±æ€§çš„åˆ†å¸ƒæ¥è¿‘ä¼¼ç­‰ä»·ç±»ä¸­ç›¸åŒå±æ€§çš„åˆ†å¸ƒæ—¶çš„ä¿¡æ¯æŸå¤±é‡ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œ{sandu_string}ã€‚",
                "KL-Divergenceå®šä¹‰": f"ç¡®å®šæ•æ„Ÿå±æ€§åœ¨åŸå§‹æ•°æ®é›†å’Œéšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„æ•°æ®é›†ä¸­çš„åˆ†å¸ƒï¼Œè®¡ç®—ä¸¤è€…ä¹‹é—´çš„KLæ•£åº¦ã€‚",
                "ç»“æœåˆ†æ": f"è¿™äº›ç»“æœè¡¨æ˜ï¼Œ{sandu_string}ã€‚KL æ•£åº¦å€¼è¶Šé«˜ï¼Œè¡¨ç¤ºåŸå§‹åˆ†å¸ƒä¸å‘å¸ƒåˆ†å¸ƒä¹‹é—´çš„å·®å¼‚è¶Šå¤§ï¼Œä¿¡æ¯æŸå¤±è¶Šå¤§ã€‚",
                "ç»“è®º": f"KL æ•£åº¦çš„è®¡ç®—ç»“æœè¡¨æ˜ï¼Œ{sandu_string}ã€‚è¾ƒé«˜çš„ KL æ•£åº¦å€¼è¡¨æ˜æ•°æ®å‘å¸ƒåçš„ä¿¡æ¯æŸå¤±è¾ƒå¤§ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå‡å°‘åŸå§‹æ•°æ®ä¸å‘å¸ƒæ•°æ®ä¹‹é—´çš„åˆ†å¸ƒå·®å¼‚ã€‚",
                    "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œæ§åˆ¶ KL æ•£åº¦ï¼Œå‡å°‘ä¿¡æ¯æŸå¤±ã€‚",
                    "åŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç­‰ä»·ç±»çš„åˆ’åˆ†ç­–ç•¥ï¼Œå‡å°‘åˆ†å¸ƒæ³„éœ²é£é™©ã€‚"
                ]
            },
            "å”¯ä¸€æ€§": {
                "æŒ‡æ ‡æ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­çš„å”¯ä¸€æ€§ã€‚å”¯ä¸€æ€§æ˜¯æŒ‡æ•°æ®é›†ä¸­å”¯ä¸€è®°å½•çš„å æ¯”ï¼Œå³åœ¨ç­‰ä»·ç±»ä¸­ä»…åŒ…å«ä¸€ä¸ªè®°å½•çš„æ¯”ä¾‹ã€‚å”¯ä¸€è®°å½•æ¯”éå”¯ä¸€è®°å½•æ›´å®¹æ˜“è¢«é‡æ–°è¯†åˆ«ï¼Œææ˜“é­å—é‡æ ‡è¯†æ”»å‡»å’Œåæ–œæ”»å‡»ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†ä¸­å”¯ä¸€è®°å½•çš„å æ¯”ä¸º {item['å”¯ä¸€æ€§']}ã€‚",
                "å”¯ä¸€æ€§å®šä¹‰": f"å”¯ä¸€æ€§æ˜¯æŒ‡æ•°æ®é›†ä¸­å”¯ä¸€è®°å½•çš„å æ¯”ã€‚åœ¨æœ€ç®€å•çš„å®šä¹‰ä¸­ï¼Œå¦‚æœç­‰ä»·ç±»ä¸­åªæœ‰ä¸€ä¸ªè®°å½•ï¼Œé‚£ä¹ˆè¯¥è®°å½•è¢«è®¤ä¸ºæ˜¯å”¯ä¸€çš„ã€‚",
                "ç»“æœåˆ†æ": f"æ ¹æ®è¯„ä¼°ç»“æœï¼Œæ•°æ®é›†ä¸­å”¯ä¸€è®°å½•çš„å æ¯”ä¸º {item['å”¯ä¸€æ€§']}ã€‚è¿™è¡¨æ˜æ•°æ®é›†ä¸­ä¸å­˜åœ¨å”¯ä¸€è®°å½•ï¼Œæ‰€æœ‰è®°å½•éƒ½å±äºå¤šä¸ªç­‰ä»·ç±»ã€‚å°½ç®¡å”¯ä¸€è®°å½•æ›´å®¹æ˜“è¢«é‡æ–°è¯†åˆ«ï¼Œä½†æœ¬æ•°æ®é›†ç”±äºæ²¡æœ‰å”¯ä¸€è®°å½•ï¼Œä»ç†è®ºä¸Šè®²ï¼Œé‡æ–°è¯†åˆ«çš„é£é™©è¾ƒä½ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ•°æ®é›†å®Œå…¨å®‰å…¨ï¼Œå› ä¸ºé‡æ ‡è¯†æ”»å‡»å’Œåæ–œæ”»å‡»ä¾ç„¶å¯èƒ½é€šè¿‡å…¶ä»–é€”å¾„å®ç°ã€‚",
                "ç»“è®º": f"æ•°æ®é›†ä¸­çš„å”¯ä¸€è®°å½•å æ¯”ä¸º {item['å”¯ä¸€æ€§']}ï¼Œè¡¨æ˜æ•°æ®é›†ä¸­ä¸å­˜åœ¨å”¯ä¸€è®°å½•ï¼Œæ‰€æœ‰è®°å½•éƒ½åœ¨å¤šä¸ªç­‰ä»·ç±»ä¸­ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸å®Œå…¨æ¶ˆé™¤éšç§æ³„éœ²çš„é£é™©ã€‚è™½ç„¶å”¯ä¸€è®°å½•æ›´å®¹æ˜“è¢«é‡æ–°è¯†åˆ«ï¼Œä½†å…¶ä»–ç±»å‹çš„æ”»å‡»ä»ç„¶å¯èƒ½å¨èƒæ•°æ®éšç§ã€‚",
                "æ”¹è¿›å»ºè®®": [
                    "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨å·®åˆ†éšç§ç­‰å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œä»¥å¢åŠ æ•°æ®çš„åŒ¿åæ€§å’Œå®‰å…¨æ€§ã€‚",
                    "ä¼˜åŒ–ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼šé€šè¿‡æ›´åˆç†çš„ç­‰ä»·ç±»åˆ’åˆ†ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªç­‰ä»·ç±»ä¸­çš„è®°å½•æ•°é‡å°½å¯èƒ½å¤šï¼Œå‡å°‘é‡æ ‡è¯†æ”»å‡»çš„å¯èƒ½æ€§ã€‚",
                    "åŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®å‘å¸ƒåçš„å®é™…ä½¿ç”¨æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´éšç§ä¿æŠ¤æªæ–½ï¼Œä»¥åº”å¯¹æ½œåœ¨çš„éšç§æ³„éœ²é£é™©ã€‚"
                ]
            }
        }

    # æ•°æ®ç‰¹å¾å¡«å……
    if "åŒ¿åé›†æ•°æ®ç‰¹å¾è¯„ä¼°ç»“æœ" in data:
            item = data["åŒ¿åé›†æ•°æ®ç‰¹å¾è¯„ä¼°ç»“æœ"]
            # print(item)
            sensitive_attribute_dimension = item["æ•æ„Ÿå±æ€§ç»´æ•°"]
            quasi_identifier_dimension = item["å‡†æ ‡è¯†ç¬¦ç»´æ•°"]
            sensitive_attribute_dimension = item["æ•æ„Ÿå±æ€§ç»´æ•°"]
            inherent_privacy = item["å›ºæœ‰éšç§"]
            summary_of_report = ""
            resultanalysis = " "
            for key in item["æ•æ„Ÿå±æ€§ç§ç±»"]:
                summary_of_report += key + " "
                resultanalysis += key + " "
            average_degree_of_generalization = item["å¹³å‡æ³›åŒ–ç¨‹åº¦"]
            report["éšç§è¯„ä¼°æŠ¥å‘Š"]["æ•°æ®ç‰¹å¾"] = {
                "å‡†æ ‡è¯†ç¬¦ç»´æ•°": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­çš„å‡†æ ‡è¯†ç¬¦ç»´æ•°ã€‚å‡†æ ‡è¯†ç¬¦ç»´æ•°æ˜¯æŒ‡ç”¨äºæ ‡è¯†ä¸ªä½“èº«ä»½çš„å±æ€§æ•°é‡ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†çš„å‡†æ ‡è¯†ç¬¦ç»´æ•°ä¸º {sensitive_attribute_dimension}ã€‚",
                    "å‡†æ ‡è¯†ç¬¦ç»´æ•°å®šä¹‰": "å‡†æ ‡è¯†ç¬¦ï¼ˆQuasi-Identifier, QIï¼‰æ˜¯æŒ‡é‚£äº›èƒ½å¤Ÿå•ç‹¬æˆ–è”åˆè¯†åˆ«ä¸ªä½“èº«ä»½çš„å±æ€§ã€‚å‡†æ ‡è¯†ç¬¦ç»´æ•°æ˜¯æŒ‡æ•°æ®é›†ä¸­ç”¨ä½œå‡†æ ‡è¯†ç¬¦çš„å±æ€§æ•°é‡ã€‚",
                    "ç»“æœåˆ†æ": f"é€šè¿‡ç»Ÿè®¡ä»¥ä¸Šå‡†æ ‡è¯†ç¬¦å±æ€§çš„æ•°é‡ï¼Œå¾—å‡ºæ•°æ®é›†çš„å‡†æ ‡è¯†ç¬¦ç»´æ•°ä¸º {quasi_identifier_dimension}ã€‚",
                    "ç»“è®º": f"æ•°æ®é›†çš„å‡†æ ‡è¯†ç¬¦ç»´æ•°ä¸º {quasi_identifier_dimension}ï¼Œè¿™æ„å‘³ç€æ•°æ®é›†ä¸­æœ‰ {quasi_identifier_dimension} ä¸ªå±æ€§å¯ä»¥ç”¨äºæ ‡è¯†ä¸ªä½“èº«ä»½ã€‚è¿™äº›å±æ€§åŒ…æ‹¬æ€§åˆ«ã€å¹´é¾„èŒƒå›´ã€éƒ¨åˆ†èº«ä»½è¯å·ç å’Œéƒ¨åˆ†ç”µè¯å·ç ã€‚äº†è§£å‡†æ ‡è¯†ç¬¦ç»´æ•°æœ‰åŠ©äºè¯„ä¼°æ•°æ®é›†çš„éšç§æ³„éœ²é£é™©ï¼Œå¹¶ä¸ºè¿›ä¸€æ­¥çš„éšç§ä¿æŠ¤æªæ–½æä¾›ä¾æ®ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å‡å°‘å‡†æ ‡è¯†ç¬¦ç»´æ•°ï¼šé€šè¿‡æ³›åŒ–æˆ–åˆ é™¤æŸäº›å‡†æ ‡è¯†ç¬¦å±æ€§ï¼Œå‡å°‘å‡†æ ‡è¯†ç¬¦ç»´æ•°ï¼Œä»è€Œé™ä½éšç§æ³„éœ²é£é™©ã€‚",
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå¦‚å·®åˆ†éšç§ï¼Œä»¥ä¿æŠ¤å‡†æ ‡è¯†ç¬¦å±æ€§çš„éšç§ã€‚",
                        "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œç¡®ä¿å‘å¸ƒçš„æ•°æ®åœ¨ä¿æŒå®ç”¨æ€§çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°ä¿æŠ¤éšç§ã€‚"
                    ]
                },
                "æ•æ„Ÿå±æ€§ç»´æ•°": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§ç»´æ•°ã€‚æ•æ„Ÿå±æ€§ç»´æ•°æ˜¯æŒ‡æ•°æ®é›†ä¸­æ¶‰åŠéšç§ä¿æŠ¤çš„æ•æ„Ÿå±æ€§æ•°é‡ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†çš„æ•æ„Ÿå±æ€§ç»´æ•°ä¸º {sensitive_attribute_dimension}ã€‚",
                    "æ•æ„Ÿå±æ€§ç»´æ•°å®šä¹‰": "æ•æ„Ÿå±æ€§ï¼ˆSensitive Attribute, SAï¼‰æ˜¯æŒ‡é‚£äº›åŒ…å«ä¸ªäººéšç§ä¿¡æ¯æˆ–éœ€è¦ä¸¥æ ¼ä¿æŠ¤çš„ä¿¡æ¯ï¼Œå¦‚åŒ»ç–—è®°å½•ã€è´¢åŠ¡ä¿¡æ¯ç­‰ã€‚æ•æ„Ÿå±æ€§ç»´æ•°æ˜¯æŒ‡æ•°æ®é›†ä¸­ç”¨ä½œæ•æ„Ÿå±æ€§çš„æ•°é‡ã€‚",
                    "ç»“æœåˆ†æ": f"é€šè¿‡ç»Ÿè®¡ä»¥ä¸Šæ•æ„Ÿå±æ€§çš„æ•°é‡ï¼Œå¾—å‡ºæ•°æ®é›†çš„æ•æ„Ÿå±æ€§ç»´æ•°ä¸º {sensitive_attribute_dimension}ã€‚",
                    "ç»“è®º": f"æ•°æ®é›†çš„æ•æ„Ÿå±æ€§ç»´æ•°ä¸º {sensitive_attribute_dimension}ï¼Œè¿™æ„å‘³ç€æ•°æ®é›†ä¸­æœ‰ {sensitive_attribute_dimension} ä¸ªå±æ€§éœ€è¦è¿›è¡Œéšç§ä¿æŠ¤ã€‚è¿™äº›å±æ€§åŒ…æ‹¬å¼€å§‹æ—¥æœŸã€ç»“æŸæ—¥æœŸå’Œé…’åº—åç§°ã€‚äº†è§£æ•æ„Ÿå±æ€§ç»´æ•°æœ‰åŠ©äºè¯„ä¼°æ•°æ®é›†çš„éšç§æ³„éœ²é£é™©ï¼Œå¹¶ä¸ºè¿›ä¸€æ­¥çš„éšç§ä¿æŠ¤æªæ–½æä¾›ä¾æ®ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å¢åŠ æ•æ„Ÿå±æ€§ä¿æŠ¤æªæ–½ï¼šé€šè¿‡åŠ å¯†ã€æ³›åŒ–æˆ–æ‰°åŠ¨ç­‰æŠ€æœ¯ï¼Œå¯¹æ•æ„Ÿå±æ€§è¿›è¡Œä¿æŠ¤ï¼Œä»¥å‡å°‘éšç§æ³„éœ²é£é™©ã€‚",
                        "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œç¡®ä¿å‘å¸ƒçš„æ•°æ®åœ¨ä¿æŒå®ç”¨æ€§çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°ä¿æŠ¤æ•æ„Ÿå±æ€§çš„éšç§ã€‚",
                        "å®šæœŸè¯„ä¼°å’Œæ›´æ–°ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®ä½¿ç”¨æƒ…å†µå’Œéšç§ä¿æŠ¤æŠ€æœ¯çš„å‘å±•ï¼Œå®šæœŸè¯„ä¼°å’Œæ›´æ–°æ•æ„Ÿå±æ€§çš„ä¿æŠ¤æªæ–½ã€‚"
                    ]
                },
                "æ•æ„Ÿå±æ€§ç§ç±»": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§ç§ç±»ã€‚æ•æ„Ÿå±æ€§æ˜¯æŒ‡é‚£äº›åŒ…å«ä¸ªäººéšç§ä¿¡æ¯æˆ–éœ€è¦ä¸¥æ ¼ä¿æŠ¤çš„ä¿¡æ¯ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§ç§ç±»åŒ…æ‹¬ {summary_of_report}",
                    "æ•æ„Ÿå±æ€§ç§ç±»å®šä¹‰": "æ•æ„Ÿå±æ€§ï¼ˆSensitive Attribute, SAï¼‰æ˜¯æŒ‡é‚£äº›åŒ…å«ä¸ªäººéšç§ä¿¡æ¯æˆ–éœ€è¦ä¸¥æ ¼ä¿æŠ¤çš„ä¿¡æ¯ã€‚è¯†åˆ«æ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§æ˜¯æ•°æ®éšç§ä¿æŠ¤çš„é¦–è¦ä»»åŠ¡ã€‚",
                    "ç»“æœåˆ†æ": f"æ ¹æ®è¯„ä¼°ç»“æœï¼Œæ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§ç§ç±»åŒ…æ‹¬ä»¥ä¸‹ {sensitive_attribute_dimension} ä¸ªï¼š{resultanalysis}",
                    "ç»“è®º": f"æ•°æ®é›†ä¸­çš„æ•æ„Ÿå±æ€§ç§ç±»åŒ…æ‹¬{resultanalysis}ã€‚è¿™äº›å±æ€§åŒ…å«ä¸ªäººéšç§ä¿¡æ¯ï¼Œéœ€åœ¨æ•°æ®å‘å¸ƒå’Œä½¿ç”¨è¿‡ç¨‹ä¸­è¿›è¡Œä¸¥æ ¼ä¿æŠ¤ã€‚äº†è§£æ•æ„Ÿå±æ€§ç§ç±»æœ‰åŠ©äºè¯„ä¼°æ•°æ®é›†çš„éšç§æ³„éœ²é£é™©ï¼Œå¹¶ä¸ºè¿›ä¸€æ­¥çš„éšç§ä¿æŠ¤æªæ–½æä¾›ä¾æ®ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å¢å¼ºæ•æ„Ÿå±æ€§ä¿æŠ¤æªæ–½ï¼šé‡‡ç”¨åŠ å¯†ã€æ³›åŒ–æˆ–æ‰°åŠ¨ç­‰æŠ€æœ¯ï¼Œå¯¹æ•æ„Ÿå±æ€§è¿›è¡Œä¿æŠ¤ï¼Œä»¥å‡å°‘éšç§æ³„éœ²é£é™©ã€‚",
                        "ä¼˜åŒ–æ•°æ®å‘å¸ƒç­–ç•¥ï¼šé€šè¿‡åˆç†çš„æ•°æ®å‘å¸ƒç­–ç•¥ï¼Œç¡®ä¿å‘å¸ƒçš„æ•°æ®åœ¨ä¿æŒå®ç”¨æ€§çš„åŒæ—¶ï¼Œæœ€å¤§é™åº¦åœ°ä¿æŠ¤æ•æ„Ÿå±æ€§çš„éšç§ã€‚",
                        "å®šæœŸè¯„ä¼°å’Œæ›´æ–°ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®ä½¿ç”¨æƒ…å†µå’Œéšç§ä¿æŠ¤æŠ€æœ¯çš„å‘å±•ï¼Œå®šæœŸè¯„ä¼°å’Œæ›´æ–°æ•æ„Ÿå±æ€§çš„ä¿æŠ¤æªæ–½ã€‚"
                    ]
                },
                "å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†çš„å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡ã€‚å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°æ˜¯æŒ‡å¹³å‡ç­‰ä»·ç»„å¤§å°ä¸ K å€¼çš„æ¯”å€¼ï¼Œç”¨äºè¡¡é‡æ•°æ®é›†çš„éšç§ä¿æŠ¤æ•ˆæœã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†çš„å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡ä¸º {average_degree_of_generalization}ã€‚",
                    "å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°å®šä¹‰": "å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡çš„å®šä¹‰ä¸ºå¹³å‡ç­‰ä»·ç»„å¤§å°ä¸ K å€¼çš„æ¯”å€¼ã€‚å…¶ä¸­ï¼Œå¹³å‡ç­‰ä»·ç»„å¤§å°æ˜¯æ•°æ®é›†ä¸­æ‰€æœ‰ç­‰ä»·ç»„å¤§å°çš„å¹³å‡å€¼ï¼ŒK å€¼æ˜¯ç»™å®šçš„K-Anonymityé˜ˆå€¼ã€‚",
                    "ç»“æœåˆ†æ": f"æ•°æ®é›†çš„å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡ä¸º {average_degree_of_generalization}ã€‚æ•°å€¼æ¯”è¾ƒå¤§ï¼Œè¡¨æ˜æ•°æ®çš„å¤„ç†æ•ˆæœè¿œè¶…å‡ºé¢„æœŸã€‚",
                    "ç»“è®º": f"æ•°æ®é›†çš„å½’ä¸€åŒ–å¹³å‡ç­‰ä»·ç»„å¤§å°åº¦é‡ä¸º {average_degree_of_generalization}ï¼Œè¡¨æ˜æ¯ä¸ªç­‰ä»·ç»„ä¸­è®°å½•çš„å¹³å‡æ•°é‡ç›¸å¯¹äº K å€¼è¾ƒå¤§ã€‚è¿™æ„å‘³ç€æ•°æ®é›†çš„ç­‰ä»·ç»„åˆ’åˆ†è¾ƒä¸ºå‡åŒ€ï¼Œéšç§ä¿æŠ¤æ•ˆæœè¾ƒå¥½ï¼Œä½†ä¹Ÿéœ€è¦è¿›ä¸€æ­¥åˆ†æå…·ä½“ç­‰ä»·ç»„çš„åˆ†å¸ƒæƒ…å†µï¼Œä»¥ç¡®ä¿æ•°æ®çš„éšç§ä¿æŠ¤æ°´å¹³ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "ä¼˜åŒ–ç­‰ä»·ç»„åˆ’åˆ†ç­–ç•¥ï¼šé€šè¿‡æ›´åˆç†çš„ç­‰ä»·ç»„åˆ’åˆ†ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªç­‰ä»·ç»„ä¸­çš„è®°å½•æ•°é‡æ›´åŠ å‡è¡¡ï¼Œè¿›ä¸€æ­¥é™ä½éšç§æ³„éœ²é£é™©ã€‚",
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨å·®åˆ†éšç§ç­‰å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œä»¥å¢åŠ æ•°æ®çš„åŒ¿åæ€§å’Œå®‰å…¨æ€§ã€‚",
                        "å®šæœŸè¯„ä¼°å’Œæ›´æ–°ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®ä½¿ç”¨æƒ…å†µå’Œéšç§ä¿æŠ¤æŠ€æœ¯çš„å‘å±•ï¼Œå®šæœŸè¯„ä¼°å’Œæ›´æ–°éšç§ä¿æŠ¤æªæ–½ã€‚"
                    ]
                },
                "å›ºæœ‰éšç§": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†çš„å›ºæœ‰éšç§ï¼ˆInherent Privacyï¼‰ã€‚å›ºæœ‰éšç§é€šè¿‡ç†µæ¥è¡¡é‡éšæœºå˜é‡åœ¨é¢å¯¹æ”»å‡»è€…æ—¶çš„éšç§ä¿æŠ¤ç¨‹åº¦ï¼Œè¡¨ç¤ºæ”»å‡»è€…éœ€è¦å›ç­”çš„äºŒå…ƒé—®é¢˜çš„æ•°é‡ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œæ•°æ®é›†çš„å›ºæœ‰éšç§ä¸º {inherent_privacy}ã€‚",
                    "å›ºæœ‰éšç§å®šä¹‰": "å³ä¸æ•°æ®é›†æ¦‚ç‡åˆ†å¸ƒçš„ä¸ç¡®å®šæ€§ç›¸åŒçš„å‡åŒ€åˆ†å¸ƒåŒºé—´é•¿åº¦ï¼Œé€šè¿‡ç†µæ¥æè¿°éšæœºå˜é‡ï¼ˆè¿™é‡ŒæŒ‡éšç§ä¿¡æ¯ï¼‰çš„ä¿æŠ¤ç¨‹åº¦ã€‚",
                    "ç»“æœåˆ†æ": f"é€šè¿‡è®¡ç®—ï¼Œæ•°æ®é›†çš„å›ºæœ‰éšç§ä¸º{inherent_privacy}ã€‚è¿™æ„å‘³ç€åœ¨æ²¡æœ‰å…¶ä»–æ¡ä»¶ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…éœ€è¦å›ç­” {inherent_privacy}ä¸ªäºŒå…ƒé—®é¢˜æ‰èƒ½ç¡®å®šéšæœºå˜é‡ çš„å…·ä½“å€¼ã€‚",
                    "ç»“è®º": f"æ•°æ®é›†çš„å›ºæœ‰éšç§ä¸º {inherent_privacy}ï¼Œè¡¨æ˜æ•°æ®é›†åœ¨éšç§ä¿æŠ¤æ–¹é¢å…·æœ‰è¾ƒé«˜çš„å¼ºåº¦ã€‚åœ¨æ²¡æœ‰å…¶ä»–æ¡ä»¶ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…éœ€è¦å›ç­”å¤§é‡çš„äºŒå…ƒé—®é¢˜æ‰èƒ½è¯†åˆ«å‡ºæ•æ„Ÿä¿¡æ¯ï¼Œä»è€Œæœ‰æ•ˆä¿æŠ¤äº†æ•°æ®çš„éšç§æ€§ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å‡å°‘æ¡ä»¶ä¿¡æ¯çš„å½±å“ï¼šé€šè¿‡é™åˆ¶æ¡ä»¶ä¿¡æ¯çš„å‘å¸ƒï¼Œå‡å°‘å…¶å¯¹éšç§å±æ€§çš„å½±å“ï¼Œå¢åŠ å›ºæœ‰éšç§çš„ä¿æŠ¤å¼ºåº¦ã€‚",
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨å·®åˆ†éšç§ç­‰å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œä»¥å¢åŠ æ•°æ®çš„åŒ¿åæ€§å’Œå®‰å…¨æ€§ã€‚",
                        "å®šæœŸè¯„ä¼°å’Œæ›´æ–°ä¿æŠ¤æªæ–½ï¼šæ ¹æ®æ•°æ®ä½¿ç”¨æƒ…å†µå’Œéšç§ä¿æŠ¤æŠ€æœ¯çš„å‘å±•ï¼Œå®šæœŸè¯„ä¼°å’Œæ›´æ–°éšç§ä¿æŠ¤æªæ–½ã€‚"
                    ]
                }
            }

    if "éšç§ä¿æŠ¤æ€§åº¦é‡è¯„ä¼°ç»“æœ" in data:
            item = data["éšç§ä¿æŠ¤æ€§åº¦é‡è¯„ä¼°ç»“æœ"]

            sensitive_attribute = []
            for attribute in item["æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©"]:
                attribute_a = {}
                attribute_a["æ•æ„Ÿå±æ€§"] = re.search('(?<=æ•æ„Ÿå±æ€§)[a-z_]*', attribute).group()
                attribute_a["é‡è¯†åˆ«é£é™©"] = re.search('(?<=é‡è¯†åˆ«é£é™©ä¸ºï¼š)[0-9\.\%]*', attribute).group()
                attribute_a["ç­‰ä»·ç»„"] = re.search('(?<=ç­‰ä»·ç»„ä¸º).*', attribute).group()
                sensitive_attribute.append(attribute_a)

            Summary_of_report = "æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©ï¼Œè¯„ä¼°è¿™äº›å±æ€§åœ¨æ•°æ®å‘å¸ƒåçš„é‡è¯†åˆ«é£é™©ï¼Œå¹¶æå‡ºç›¸åº”çš„å»ºè®®ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œç‰¹åˆ«å…³æ³¨å±æ€§ä¸º"
            Result_analysis = ""
            conclusion = ""
            Re_identification = item["åŸºäºç†µçš„é‡è¯†åˆ«é£é™©"]
            Reidentification_risk = re.search('(?<=é‡è¯†åˆ«é£é™©ä¸ºï¼š)[0-9\.\%]*', item["åŸºäºç†µçš„é‡è¯†åˆ«é£é™©"]).group()
            Equivalence_group = re.search('(?<=ç­‰ä»·ç»„ä¸º).*', item["åŸºäºç†µçš„é‡è¯†åˆ«é£é™©"]).group()

            for attribute in sensitive_attribute:
                Summary_of_report += attribute["æ•æ„Ÿå±æ€§"] + "," + attribute["æ•æ„Ÿå±æ€§"] + "çš„é‡è¯†åˆ«é£é™©ä¸º " + \
                                     attribute["é‡è¯†åˆ«é£é™©"]
                Result_analysis += attribute_a["æ•æ„Ÿå±æ€§"] + "çš„é‡è¯†åˆ«é£é™©è¾ƒé«˜,ä¸º" + attribute_a["é‡è¯†åˆ«é£é™©"]
                conclusion += attribute_a["æ•æ„Ÿå±æ€§"] + "åœ¨ç­‰ä»·ç»„" + attribute_a["ç­‰ä»·ç»„"] + "çš„é‡è¯†åˆ«é£é™©è¾ƒé«˜ã€‚"

            sensitive_attribute = []
            for attribute in item["å•ä¸ªå±æ€§çš„é‡è¯†åˆ«é£é™©"]:
                attribute_a = {}
                attribute_a["æ ‡è¯†ç¬¦å±æ€§"] = re.search('(?<=æ ‡è¯†ç¬¦å±æ€§)[a-z_]*', attribute).group()
                attribute_a["é‡è¯†åˆ«é£é™©"] = re.search('(?<=é‡è¯†åˆ«é£é™©ä¸ºï¼š)[0-9\.\%]*', attribute).group()
                attribute_a["å±æ€§å€¼"] = re.search('(?<=å¯¹åº”å±æ€§å€¼ä¸º).*', attribute).group()
                sensitive_attribute.append(attribute_a)

            Summary_of_report = ""
            Result_analysis = ""
            conclusion = ""
            for attribute in sensitive_attribute:
                Summary_of_report += attribute["æ ‡è¯†ç¬¦å±æ€§"] + "ä¸º" + attribute["é‡è¯†åˆ«é£é™©"] + ","
                if float(attribute["é‡è¯†åˆ«é£é™©"].replace('%', '')) / 100 > 0.0030:
                    Result_analysis += attribute["æ ‡è¯†ç¬¦å±æ€§"] + "çš„é‡è¯†åˆ«é£é™©è¾ƒé«˜ï¼Œä¸ºï¼š" + attribute["é‡è¯†åˆ«é£é™©"] + "ã€‚"
                    conclusion += attribute["æ ‡è¯†ç¬¦å±æ€§"] + "å…·æœ‰è¾ƒé«˜çš„é‡è¯†åˆ«é£é™©" + "ï¼Œ"
                else:
                    Result_analysis += attribute["æ ‡è¯†ç¬¦å±æ€§"] + "çš„é‡è¯†åˆ«é£é™©è¾ƒä½ï¼Œä¸ºï¼š" + attribute["é‡è¯†åˆ«é£é™©"] + "ã€‚"
                    conclusion += attribute["æ ‡è¯†ç¬¦å±æ€§"] + "å…·æœ‰è¾ƒä½çš„é‡è¯†åˆ«é£é™©" + "ï¼Œ"

            report["éšç§è¯„ä¼°æŠ¥å‘Š"]["éšç§ä¿æŠ¤æ€§åº¦é‡"] = {
                "æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©": {
                    "æŠ¥å‘Šæ‘˜è¦": f"{Summary_of_report}",
                    "æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©å®šä¹‰": "è¯¥ç®—æ³•é€šè¿‡è®¡ç®—éšç§ä¿æŠ¤æŠ€æœ¯åº”ç”¨åçš„æœ€å¤§ç†µå’Œç›¸å¯¹ç†µæ¥é‡åŒ–æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©ã€‚å…¶ä¸­æœ€å¤§ç†µå€¼è¡¨ç¤ºä¿¡æ¯çš„ä¸ç¡®å®šæ€§ï¼Œç›¸å¯¹ç†µå€¼è¡¨ç¤ºéšç§ä¿æŠ¤æŠ€æœ¯å¯¹æ•°æ®çš„å®‰å…¨ä¿æŠ¤å½±å“ã€‚é€šè¿‡è¯„ä¼°æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©ï¼Œå¯ä»¥æ›´å¥½åœ°äº†è§£æ•°æ®å‘å¸ƒåçš„éšç§é£é™©ï¼Œå¹¶é‡‡å–é€‚å½“çš„æªæ–½è¿›è¡Œä¿æŠ¤ã€‚",
                    "ç»“æœåˆ†æ": f"{Result_analysis}",
                    "ç»“è®º": f"{conclusion}",
                    "æ”¹è¿›å»ºè®®": [
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå¦‚å·®åˆ†éšç§ï¼Œä»¥é™ä½é‡è¯†åˆ«é£é™©ã€‚",
                        "ä¼˜åŒ–æ•°æ®æ³›åŒ–ç­–ç•¥ï¼šé€šè¿‡æ›´ç»†ç²’åº¦çš„æ³›åŒ–ç­–ç•¥ï¼Œå‡å°‘æ•°æ®çš„ä¸ç¡®å®šæ€§ï¼Œæé«˜æ•°æ®çš„å‡†ç¡®æ€§ã€‚",
                        "æé«˜æ•°æ®åŒ¿ååŒ–æ°´å¹³ï¼šé€šè¿‡æ›´é«˜æ°´å¹³çš„åŒ¿ååŒ–æŠ€æœ¯ï¼Œä¿æŠ¤ä¸ªäººéšç§ä¸è¢«è½»æ˜“è¯†åˆ«ã€‚",
                        "åŠ¨æ€è°ƒæ•´ç­‰ä»·ç»„ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç­‰ä»·ç»„ï¼Œä»¥é™ä½ç‰¹å®šç»„åˆçš„é‡è¯†åˆ«é£é™©ã€‚"
                    ]
                },
                "æ•´ä½“çš„é‡è¯†åˆ«é£é™©": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­æ‰€æœ‰æ•æ„Ÿå±æ€§çš„æ•´ä½“é‡è¯†åˆ«é£é™©ã€‚é€šè¿‡åŸºäºç†µçš„é‡è¯†åˆ«é£é™©æµ‹é‡æ¨¡å‹ï¼Œè¯„ä¼°æ•°æ®é›†ä¸­æ‰€æœ‰æ•æ„Ÿå±æ€§åœ¨æ•°æ®å‘å¸ƒåçš„é‡è¯†åˆ«é£é™©ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œ{Re_identification} ",
                    "æ•´ä½“çš„é‡è¯†åˆ«é£é™©å®šä¹‰": "æ•´ä½“çš„é‡è¯†åˆ«é£é™©å®šä¹‰ä¸æ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©å®šä¹‰åŸºæœ¬ç›¸åŒï¼Œå”¯ä¸€ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œå…¶å…³æ³¨çš„æ˜¯æ‰€æœ‰çš„æ•æ„Ÿå±æ€§ï¼Œè¯„ä¼°æ‰€æœ‰æ•æ„Ÿå±æ€§çš„æ•´ä½“é£é™©ã€‚",
                    "ç»“æœåˆ†æ": f"é€šè¿‡è¯„ä¼°æ‰€æœ‰æ•æ„Ÿå±æ€§ï¼Œè®¡ç®—å¾—åˆ°æ•´ä½“é‡è¯†åˆ«é£é™©ã€‚{Re_identification}",
                    "ç»“è®º": f"æ•´ä½“é‡è¯†åˆ«é£é™©ä¸º {Reidentification_risk}ï¼Œè¡¨æ˜æ•°æ®é›†ä¸­æ‰€æœ‰æ•æ„Ÿå±æ€§åœ¨éšç§ä¿æŠ¤æªæ–½åº”ç”¨åï¼Œä»å­˜åœ¨è¾ƒé«˜çš„é‡è¯†åˆ«é£é™©ã€‚é«˜é£é™©ç­‰ä»·ç»„{Equivalence_group}æ˜¾ç¤ºåœ¨è¿™äº›å±æ€§ç»„åˆä¸‹ï¼Œä¸ªäººä¿¡æ¯çš„é‡è¯†åˆ«æ¦‚ç‡è¾ƒå¤§ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå¦‚å·®åˆ†éšç§ï¼Œä»¥é™ä½é‡è¯†åˆ«é£é™©ã€‚",
                        "ä¼˜åŒ–æ•°æ®æ³›åŒ–ç­–ç•¥ï¼šé€šè¿‡æ›´ç»†ç²’åº¦çš„æ³›åŒ–ç­–ç•¥ï¼Œå‡å°‘æ•°æ®çš„ä¸ç¡®å®šæ€§ï¼Œæé«˜æ•°æ®çš„å‡†ç¡®æ€§ã€‚",
                        "æé«˜æ•°æ®åŒ¿ååŒ–æ°´å¹³ï¼šé€šè¿‡æ›´é«˜æ°´å¹³çš„åŒ¿ååŒ–æŠ€æœ¯ï¼Œä¿æŠ¤ä¸ªäººéšç§ä¸è¢«è½»æ˜“è¯†åˆ«ã€‚",
                        "åŠ¨æ€è°ƒæ•´ç­‰ä»·ç»„ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´ç­‰ä»·ç»„ï¼Œä»¥é™ä½ç‰¹å®šç»„åˆçš„é‡è¯†åˆ«é£é™©ã€‚"
                    ]
                },
                "å•ä¸ªå±æ€§çš„é‡è¯†åˆ«é£é™©": {
                    "æŠ¥å‘Šæ‘˜è¦": f"æœ¬æŠ¥å‘Šæ—¨åœ¨è¯„ä¼°æ•°æ®é›†ä¸­æ¯ä¸ªå‡†æ ‡è¯†ç¬¦å±æ€§çš„é‡è¯†åˆ«é£é™©ã€‚ä¸æ•´ä½“é‡è¯†åˆ«é£é™©å’Œæ•æ„Ÿå±æ€§çš„é‡è¯†åˆ«é£é™©ä¸åŒï¼Œæœ¬æŠ¥å‘Šèšç„¦äºå•ä¸ªå‡†æ ‡è¯†ç¬¦å±æ€§ï¼Œå¹¶è¯„ä¼°æ”»å‡»è€…åˆ©ç”¨å…¶åœ¨æ•°æ®å‘å¸ƒåå¯èƒ½é€ æˆçš„é‡è¯†åˆ«é£é™©ã€‚æœ¬æ¬¡è¯„ä¼°ç»“æœæ˜¾ç¤ºï¼Œä¸åŒå‡†æ ‡è¯†ç¬¦å±æ€§çš„åŸºäºç†µçš„é‡è¯†åˆ«é£é™©å¦‚ä¸‹ï¼š{Summary_of_report}",
                    "å•ä¸ªå±æ€§çš„é‡è¯†åˆ«é£é™©å®šä¹‰": "å•ä¸ªå±æ€§çš„é‡è¯†åˆ«é£é™©å’Œä¸Šè¿°ä¸¤ä¸ªæŒ‡æ ‡çš„åœ¨äºï¼Œå…¶ä¸ä¼šä»¥ç­‰ä»·ç»„çš„è§’åº¦è€ƒè™‘é‡è¯†åˆ«é£é™©ï¼Œè€Œæ˜¯ç­‰ä»·ç»„ä¸­çš„æŸä¸€ä¸ªå…·ä½“çš„å‡†æ ‡è¯†ç¬¦å±æ€§è€ƒè™‘æ•°æ®çš„é‡è¯†åˆ«é£é™©ã€‚å³ï¼Œèšç„¦äºå•ä¸ªå‡†æ ‡è¯†ç¬¦å±æ€§ï¼Œè¯„ä¼°æ”»å‡»è€…åˆ©ç”¨å…¶åœ¨æ•°æ®å‘å¸ƒåå¯èƒ½é€ æˆçš„é‡è¯†åˆ«é£é™©ã€‚",
                    "ç»“æœåˆ†æ": f"ç»“æœè¡¨æ˜ï¼Œä¸åŒå±æ€§çš„é‡è¯†åˆ«é£é™©å­˜åœ¨æ˜¾è‘—å·®å¼‚ã€‚å…¶ä¸­ï¼Œ{Result_analysis}",
                    "ç»“è®º": f"å•ä¸ªå±æ€§çš„é‡è¯†åˆ«é£é™©è¯„ä¼°ç»“æœè¡¨æ˜ï¼Œ{conclusion}è¿™éœ€è¦åœ¨æ•°æ®å‘å¸ƒæ—¶ç‰¹åˆ«å…³æ³¨é«˜é£é™©å±æ€§ï¼Œé‡‡å–æ›´ä¸¥æ ¼çš„éšç§ä¿æŠ¤æªæ–½ã€‚",
                    "æ”¹è¿›å»ºè®®": [
                        "å¢å¼ºéšç§ä¿æŠ¤æŠ€æœ¯ï¼šé‡‡ç”¨æ›´å…ˆè¿›çš„éšç§ä¿æŠ¤æŠ€æœ¯ï¼Œå¦‚å·®åˆ†éšç§ï¼Œä»¥é™ä½é«˜é£é™©å±æ€§çš„é‡è¯†åˆ«é£é™©ã€‚",
                        "ä¼˜åŒ–æ•°æ®æ³›åŒ–ç­–ç•¥ï¼šé€šè¿‡æ›´ç»†ç²’åº¦çš„æ³›åŒ–ç­–ç•¥ï¼Œå‡å°‘é«˜é£é™©å±æ€§çš„ä¸ç¡®å®šæ€§ï¼Œæé«˜æ•°æ®çš„å‡†ç¡®æ€§ã€‚",
                        "æé«˜æ•°æ®åŒ¿ååŒ–æ°´å¹³ï¼šé€šè¿‡æ›´é«˜æ°´å¹³çš„åŒ¿ååŒ–æŠ€æœ¯ï¼Œä¿æŠ¤é«˜é£é™©å±æ€§çš„ä¸ªäººéšç§ä¸è¢«è½»æ˜“è¯†åˆ«ã€‚",
                        "åŠ¨æ€è°ƒæ•´å±æ€§ä¿æŠ¤ç­–ç•¥ï¼šæ ¹æ®å®é™…æ•°æ®æƒ…å†µï¼ŒåŠ¨æ€è°ƒæ•´é«˜é£é™©å±æ€§çš„ä¿æŠ¤ç­–ç•¥ï¼Œä»¥é™ä½ç‰¹å®šå±æ€§çš„é‡è¯†åˆ«é£é™©ã€‚"
                    ]
                }
            }
    # è¿”å›æœ‰åºçš„ JSON å“åº”
    report = generate_privacy_report(worker_id, report)

    return jsonify(report)




## Page 1 ä»»åŠ¡æ€»æ•°







## Page 2 æŒ‡æ ‡ä½“ç³»å¯è§†åŒ–

# æ•°æ®å›¾è°±
# æ ‡ç­¾åˆ°ç§ç±»çš„æ˜ å°„
# æ•°æ®ï¼šcall  ç§»åŠ¨é€šä¿¡åœºæ™¯
label_to_category = {
    "User": "ç”¨æˆ·id",
    "Calling_party_number": "ä¸»å«å·ç ",
    "Calling_party_province": "ä¸»å«çœä»½",
    "Calling_party_city": "ä¸»å«åŸå¸‚",
    "Called_party_number": "è¢«å«å·ç ",
    "Called_party_province": "è¢«å«çœä»½",
    "Called_party_city": "è¢«å«åŸå¸‚",
    "Talk_time": "é€šè¯æ—¶é—´",
    "Call_duration": "é€šè¯æ—¶é•¿"
}
lp_to_category = {
    "Bill_id": "è´¦å•id",
    "User": "ç”¨æˆ·id",
    "Mobile_phone_number": "ç”µè¯å·ç ",
    "Package_monthly_rent": "è®¢å•ç§ç±»",
    "Extra_fee": "å¢å€¼è´¹",
    "Total_cost": "æ€»é‡‘é¢",
    "Deduct_time": "äº¤æ˜“æ—¶é—´",
    "Account_balance": "è´¦æˆ·ä½™é¢"
}
ls_to_category = {
    "User": "ç”¨æˆ·id",
    "Sender_number": "å‘é€æ–¹ç”µè¯",
    "Sender_province": "å‘é€æ–¹çœä»½",
    "Sender_city": "å‘é€æ–¹å¸‚åŒº",
    "Receiver_number": "æ¥æ”¶æ–¹ç”µè¯",
    "Receiver_province": "æ¥æ”¶æ–¹çœä»½",
    "Receiver_city": "æ¥æ”¶æ–¹å¸‚åŒº",
    "Sending_time": "çŸ­ä¿¡æ—¶é—´",
    "Sms_content": "çŸ­ä¿¡å†…å®¹",
}
lm_to_category = {
    "User": "å§“å",
    "Sex": "æ€§åˆ«",
    "Birthday": "ç”Ÿæ—¥",
    "Age": "å¹´é¾„",
    "Id_number": "èº«ä»½è¯å·",
    "Phone": "ç”µè¯å·ç ",
    "Day": "è¯Šç–—æ—¥æœŸ",
    "Address": "å®¶åº­ä½å€",
    "Hospital_department": "ç§‘å®¤",
    "Symptom": "ç—‡çŠ¶"
}

@api_show.route('/telecom_graph', methods=['GET'])
def get_telecom_graph():
    # Cypher æŸ¥è¯¢
    query = """
    MATCH (n)-[r]->(m)
    WHERE n.scene = 'ç§»åŠ¨é€šä¿¡'
    RETURN labels(n) AS source_labels, n AS source_node,
           labels(m) AS target_labels, m AS target_node, r AS relationship
    LIMIT 100
    """

    # åŠ è½½æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
    with open("./telem.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    # ä½¿ç”¨å­—å…¸å­˜å‚¨èŠ‚ç‚¹å’Œåˆ—è¡¨å­˜å‚¨å…³ç³»
    nodes = {}
    links = []

    # éå†æŸ¥è¯¢ç»“æœ
    for record in result:
        # æå–æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹å’Œå…³ç³»
        source_node = record["source_node"]
        target_node = record["target_node"]
        relationship = record["relationship"]

        # æå–èŠ‚ç‚¹æ ‡ç­¾
        source_label = record["source_labels"][0]  # å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ ‡ç­¾
        target_label = record["target_labels"][0]

        # æ ¹æ®æ ‡ç­¾è·å–ç§ç±»
        source_category = label_to_category.get(source_label, "æœªçŸ¥ç§ç±»")
        target_category = label_to_category.get(target_label, "æœªçŸ¥ç§ç±»")

        # æ·»åŠ æºèŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if source_node["identity"] not in nodes:
            nodes[source_node["identity"]] = {
                "id": source_node["identity"],  # ä½¿ç”¨ identity ä½œä¸ºå”¯ä¸€æ ‡è¯†
                "name": source_node["properties"].get("user_id", source_node["properties"].get("value", "æœªåˆå§‹åŒ–")),
                "category": source_category,  # åˆ†ç±»
                "symbolSize": 40 if source_category == "ç”¨æˆ·id" else 20,  # æ ¹æ®ç±»å‹è°ƒæ•´å¤§å°
                "scene": source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")  # åœºæ™¯ä¿¡æ¯
            }

        # æ·»åŠ ç›®æ ‡èŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if target_node["identity"] not in nodes:
            nodes[target_node["identity"]] = {
                "id": target_node["identity"],
                "name": target_node["properties"].get("value", target_node["properties"].get("name", "æœªåˆå§‹åŒ–")),
                "category": target_category,
                "symbolSize": 40 if target_category == "ç”¨æˆ·id" else 20,
                "scene": target_node["properties"].get("scene", "åº§æœºé€šè¯")
            }

        # æ·»åŠ å…³ç³»åˆ° links
        links.append({
            "source": source_node["identity"],  # æºèŠ‚ç‚¹ ID
            "target": target_node["identity"],  # ç›®æ ‡èŠ‚ç‚¹ ID
            "value": relationship["type"],  # å…³ç³»ç±»å‹
            "scene": relationship["properties"].get("scene", "æœªçŸ¥åœºæ™¯")  # åœºæ™¯ä¿¡æ¯
        })

    # è½¬æ¢ä¸º ECharts æ”¯æŒçš„æ ¼å¼
    return jsonify({
        "nodes": list(nodes.values()),  # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨
        "links": links
    })


# åŒ»ç–—å«ç”Ÿ
@api_show.route('/medical_graph', methods=['GET'])
def get_medical_graph():
    # Cypher æŸ¥è¯¢
    query = """
    MATCH (n)-[r]->(m)
    WHERE n.scene = 'åŒ»ç–—å«ç”Ÿ'
    RETURN labels(n) AS source_labels, n AS source_node,
           labels(m) AS target_labels, m AS target_node, r AS relationship
    LIMIT 100
    """

    # åŠ è½½æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
    with open("./medical.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    # ä½¿ç”¨å­—å…¸å­˜å‚¨èŠ‚ç‚¹å’Œåˆ—è¡¨å­˜å‚¨å…³ç³»
    nodes = {}
    links = []

    # éå†æŸ¥è¯¢ç»“æœ
    for record in result:
        # æå–æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹å’Œå…³ç³»
        source_node = record["source_node"]
        target_node = record["target_node"]
        relationship = record["relationship"]

        # æå–èŠ‚ç‚¹æ ‡ç­¾
        source_label = record["source_labels"][0]  # å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ ‡ç­¾
        target_label = record["target_labels"][0]

        # æ ¹æ®æ ‡ç­¾è·å–ç§ç±»
        source_category = lm_to_category.get(source_label, "æœªçŸ¥ç§ç±»")
        target_category = lm_to_category.get(target_label, "æœªçŸ¥ç§ç±»")

        # æ·»åŠ æºèŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if source_node["identity"] not in nodes:
            nodes[source_node["identity"]] = {
                "id": source_node["identity"],  # ä½¿ç”¨ identity ä½œä¸ºå”¯ä¸€æ ‡è¯†
                "name": source_node["properties"].get("user_id", source_node["properties"].get("value", "æœªåˆå§‹åŒ–")),
                "category": source_category,  # åˆ†ç±»
                "symbolSize": 40 if source_category == "å§“å" else 20,  # æ ¹æ®ç±»å‹è°ƒæ•´å¤§å°
                "scene": source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")  # åœºæ™¯ä¿¡æ¯
            }

        # æ·»åŠ ç›®æ ‡èŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if target_node["identity"] not in nodes:
            nodes[target_node["identity"]] = {
                "id": target_node["identity"],
                "name": target_node["properties"].get("value", target_node["properties"].get("name", "æœªåˆå§‹åŒ–")),
                "category": target_category,
                "symbolSize": 40 if target_category == "å§“å" else 20,
                "scene": target_node["properties"].get("scene", "åŒ»ç–—å«ç”Ÿ")
            }

        # æ·»åŠ å…³ç³»åˆ° links
        links.append({
            "source": source_node["identity"],  # æºèŠ‚ç‚¹ ID
            "target": target_node["identity"],  # ç›®æ ‡èŠ‚ç‚¹ ID
            "value": relationship["type"],  # å…³ç³»ç±»å‹
            "scene": relationship["properties"].get("scene", "æœªçŸ¥åœºæ™¯")  # åœºæ™¯ä¿¡æ¯
        })

    # è½¬æ¢ä¸º ECharts æ”¯æŒçš„æ ¼å¼
    return jsonify({
        "nodes": list(nodes.values()),  # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨
        "links": links
    })

# çŸ­ä¿¡ä¸šåŠ¡
@api_show.route('/sms_graph', methods=['GET'])
def get_sms_graph():
    # Cypher æŸ¥è¯¢
    query = """
        MATCH (n)-[r]->(m)
        WHERE n.scene = 'çŸ­ä¿¡ä¸šåŠ¡'
        RETURN labels(n) AS source_labels, n AS source_node,
               labels(m) AS target_labels, m AS target_node, r AS relationship
        LIMIT 300
        """
    # åŠ è½½æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
    with open("./sms.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    # ä½¿ç”¨å­—å…¸å­˜å‚¨èŠ‚ç‚¹å’Œåˆ—è¡¨å­˜å‚¨å…³ç³»
    nodes = {}
    links = []

    # éå†æŸ¥è¯¢ç»“æœ
    for record in result:
        # æå–æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹å’Œå…³ç³»
        source_node = record["source_node"]
        target_node = record["target_node"]
        relationship = record["relationship"]

        # æå–èŠ‚ç‚¹æ ‡ç­¾
        source_label = record["source_labels"][0]  # å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ ‡ç­¾
        target_label = record["target_labels"][0]

        # æ ¹æ®æ ‡ç­¾è·å–ç§ç±»
        source_category = ls_to_category.get(source_label, "æœªçŸ¥ç§ç±»")
        target_category = ls_to_category.get(target_label, "æœªçŸ¥ç§ç±»")

        # æ·»åŠ æºèŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if source_node["identity"] not in nodes:
            nodes[source_node["identity"]] = {
                "id": source_node["identity"],  # ä½¿ç”¨ identity ä½œä¸ºå”¯ä¸€æ ‡è¯†
                "name": source_node["properties"].get("user_id", source_node["properties"].get("value", "æœªåˆå§‹åŒ–")),
                "category": source_category,  # åˆ†ç±»
                "symbolSize": 40 if source_category == "ç”¨æˆ·id" else 20,  # æ ¹æ®ç±»å‹è°ƒæ•´å¤§å°
                "scene": source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")  # åœºæ™¯ä¿¡æ¯
            }

        # æ·»åŠ ç›®æ ‡èŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if target_node["identity"] not in nodes:
            nodes[target_node["identity"]] = {
                "id": target_node["identity"],
                "name": target_node["properties"].get("value", target_node["properties"].get("name", "æœªåˆå§‹åŒ–")),
                "category": target_category,
                "symbolSize": 40 if target_category == "ç”¨æˆ·id" else 20,
                "scene": target_node["properties"].get("scene", "çŸ­ä¿¡ä¸šåŠ¡")
            }

        # æ·»åŠ å…³ç³»åˆ° links
        links.append({
            "source": source_node["identity"],  # æºèŠ‚ç‚¹ ID
            "target": target_node["identity"],  # ç›®æ ‡èŠ‚ç‚¹ ID
            "value": relationship["type"],  # å…³ç³»ç±»å‹
            "scene": relationship["properties"].get("scene", "æœªçŸ¥åœºæ™¯")  # åœºæ™¯ä¿¡æ¯
        })

    # è½¬æ¢ä¸º ECharts æ”¯æŒçš„æ ¼å¼
    return jsonify({
        "nodes": list(nodes.values()),  # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨
        "links": links
    })
# ç½‘ç»œæ”¯ä»˜
@api_show.route('/purch_graph', methods=['GET'])
def get_telecm_graph():
    # Cypher æŸ¥è¯¢
    query = """
    MATCH (n)-[r]->(m)
    WHERE n.scene = 'ç½‘ç»œæ”¯ä»˜'
    RETURN labels(n) AS source_labels, n AS source_node,
           labels(m) AS target_labels, m AS target_node, r AS relationship
    LIMIT 100
    """
    # åŠ è½½æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
    with open("./purch.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    # ä½¿ç”¨å­—å…¸å­˜å‚¨èŠ‚ç‚¹å’Œåˆ—è¡¨å­˜å‚¨å…³ç³»
    nodes = {}
    links = []

    # éå†æŸ¥è¯¢ç»“æœ
    for record in result:
        # æå–æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹å’Œå…³ç³»
        source_node = record["source_node"]
        target_node = record["target_node"]
        relationship = record["relationship"]

        # æå–èŠ‚ç‚¹æ ‡ç­¾
        source_label = record["source_labels"][0]  # å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ ‡ç­¾
        target_label = record["target_labels"][0]

        # æ ¹æ®æ ‡ç­¾è·å–ç§ç±»
        source_category = lp_to_category.get(source_label, "æœªçŸ¥ç§ç±»")
        target_category = lp_to_category.get(target_label, "æœªçŸ¥ç§ç±»")

        # æ·»åŠ æºèŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if source_node["identity"] not in nodes:
            nodes[source_node["identity"]] = {
                "id": source_node["identity"],  # ä½¿ç”¨ identity ä½œä¸ºå”¯ä¸€æ ‡è¯†
                "name": source_node["properties"].get("user_id", source_node["properties"].get("value", "æœªåˆå§‹åŒ–")),
                "category": source_category,  # åˆ†ç±»
                "symbolSize": 40 if source_category == "ç”¨æˆ·id" else 20,  # æ ¹æ®ç±»å‹è°ƒæ•´å¤§å°
                "scene": source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")  # åœºæ™¯ä¿¡æ¯
            }

        # æ·»åŠ ç›®æ ‡èŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if target_node["identity"] not in nodes:
            nodes[target_node["identity"]] = {
                "id": target_node["identity"],
                "name": target_node["properties"].get("value", target_node["properties"].get("name", "æœªåˆå§‹åŒ–")),
                "category": target_category,
                "symbolSize": 40 if target_category == "ç”¨æˆ·id" else 20,
                "scene": target_node["properties"].get("scene", "ç½‘ç»œæ”¯ä»˜")
            }

        # æ·»åŠ å…³ç³»åˆ° links
        links.append({
            "source": source_node["identity"],  # æºèŠ‚ç‚¹ ID
            "target": target_node["identity"],  # ç›®æ ‡èŠ‚ç‚¹ ID
            "value": relationship["type"],  # å…³ç³»ç±»å‹
            "scene": relationship["properties"].get("scene", "æœªçŸ¥åœºæ™¯")  # åœºæ™¯ä¿¡æ¯
        })

    # è½¬æ¢ä¸º ECharts æ”¯æŒçš„æ ¼å¼
    return jsonify({
        "nodes": list(nodes.values()),  # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨
        "links": links
    })

#  å¤šæ ·æœ¬å±æ€§å…³è”

@api_show.route('/link_graph', methods=['GET'])
def get_link_graph():
    ## è¿›è¡Œé‡è¯†åˆ«
    q="""
    MATCH (u1:User)-[r1]->(other1), (u2:User)-[r2]->(other2)
    WHERE u1.user_id = u2.user_id AND u1.scene <> u2.scene
    WITH u1, u2, COLLECT(DISTINCT r1) AS relations1, COLLECT(DISTINCT r2) AS relations2, other1, other2
    RETURN 
        labels(u1) AS source_labels1, 
        u1 AS source_node1,
        labels(u2) AS source_labels2, 
        u2 AS source_node2,
        labels(other1) AS target_labels1, 
        other1 AS target_node1,
        labels(other2) AS target_labels2, 
        other2 AS target_node2,
        relations1 AS relationships_from_u1, 
        relations2 AS relationships_from_u2,
        {source: u1.user_id, target: u2.user_id, relationshipType: "LOGICAL_LINK", style: "dashed"} AS virtual_relationship
    LIMIT 100
    """
    """
    MATCH (u:User)-[r]->(b)
    WHERE r.scene IN ["åŸºç¡€ä¿¡æ¯", "åŒ»ç–—å«ç”Ÿ"]
    WITH b, COLLECT(DISTINCT r.scene) AS relatedScenes, COLLECT(DISTINCT {user: u, relation: r}) AS details
    WHERE SIZE(relatedScenes) > 1  // ç­›é€‰å‡ºä¸å¤šä¸ªåœºæ™¯ç›¸å…³çš„ç›®æ ‡èŠ‚ç‚¹
    UNWIND details AS detail
    RETURN 
    labels(detail.user) AS source_labels, 
    detail.user AS source_node,
    labels(b) AS target_labels, 
    b AS target_node, 
    detail.relation AS relationship
    """
    # åŠ è½½æ–‡ä»¶å†…å®¹åˆ°å†…å­˜
    with open("./link.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    # ä½¿ç”¨å­—å…¸å­˜å‚¨èŠ‚ç‚¹å’Œåˆ—è¡¨å­˜å‚¨å…³ç³»
    # with open("re.json","r",encoding="utf-8-sig") as f:
    #     result+=json.load(f)
    nodes = {}
    links = []

    # éå†æŸ¥è¯¢ç»“æœ
    for record in result:
        # æå–æºèŠ‚ç‚¹ã€ç›®æ ‡èŠ‚ç‚¹å’Œå…³ç³»
        source_node = record["source_node"]
        target_node = record["target_node"]
        relationship = record["relationship"]

        # æå–èŠ‚ç‚¹æ ‡ç­¾
        source_label = record["source_labels"][0]  # å‡è®¾æ¯ä¸ªèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªæ ‡ç­¾
        target_label = record["target_labels"][0]

        # æ ¹æ®æ ‡ç­¾è·å–ç§ç±»
        s_kind=(
                label_to_category.get(source_label) or
                lp_to_category.get(source_label) or
                ls_to_category.get(source_label) or
                lm_to_category.get(source_label) or
                "æœªçŸ¥ç§ç±»"  # é»˜è®¤å€¼
        )
        t_kind=(
            label_to_category.get(target_label) or
            lp_to_category.get(target_label) or
            ls_to_category.get(target_label) or
            lm_to_category.get(target_label) or
            "æœªçŸ¥ç§ç±»"  # é»˜è®¤å€¼
        )
        source_category = source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")
        target_category = target_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")

        # æ·»åŠ æºèŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if source_node["identity"] not in nodes:
            nodes[source_node["identity"]] = {
                "id": source_node["identity"],  # ä½¿ç”¨ identity ä½œä¸ºå”¯ä¸€æ ‡è¯†
                "name": source_node["properties"].get("user_id", source_node["properties"].get("value", "æœªåˆå§‹åŒ–")),
                "category": source_category,  # åœºæ™¯åˆ†ç±»
                "symbolSize": 40 if target_category == "ç”¨æˆ·id" else 20, # æ ¹æ®ç±»å‹è°ƒæ•´å¤§å°
                "attr":s_kind,
                "scene": source_node["properties"].get("scene", "æ— åœºæ™¯ä¿¡æ¯çš„å±æ€§èŠ‚ç‚¹")  # åœºæ™¯ä¿¡æ¯
            }

        # æ·»åŠ ç›®æ ‡èŠ‚ç‚¹åˆ° nodesï¼ˆé¿å…é‡å¤ï¼‰
        if target_node["identity"] not in nodes:
            nodes[target_node["identity"]] = {
                "id": target_node["identity"],
                "name": target_node["properties"].get("value", target_node["properties"].get("name", "æœªåˆå§‹åŒ–")),
                "category": target_category,
                "attr": t_kind,
                "symbolSize": 40 if target_category == "ç”¨æˆ·id" else 20,
                "scene": target_node["properties"].get("scene", "å±æ€§èŠ‚ç‚¹")
            }

        # æ·»åŠ å…³ç³»åˆ° links
        links.append({
            "source": source_node["identity"],  # æºèŠ‚ç‚¹ ID
            "target": target_node["identity"],  # ç›®æ ‡èŠ‚ç‚¹ ID
            "value": relationship["type"],  # å…³ç³»ç±»å‹
            "scene": relationship["properties"].get("scene", "æœªçŸ¥åœºæ™¯")  # åœºæ™¯ä¿¡æ¯
        })

    # è½¬æ¢ä¸º ECharts æ”¯æŒçš„æ ¼å¼
    return jsonify({
        "nodes": list(nodes.values()),  # å°†å­—å…¸è½¬æ¢ä¸ºåˆ—è¡¨
        "links": links
    })


# è½¬æ¢ä¸º ECharts æ ¼å¼çš„å‡½æ•°
def process_to_echart_format(query_results):
    with open("re.json", "r", encoding="utf-8-sig") as file:
        result = json.load(file)  # åŠ è½½ JSON æ–‡ä»¶å†…å®¹
    nodes = []
    links = []

    # ç”¨äºå»é‡ï¼Œé¿å…é‡å¤èŠ‚ç‚¹æˆ–è¾¹
    added_nodes = set()
    added_links = set()

    for record in result:
        # å¤„ç†æºèŠ‚ç‚¹ u1 å’Œ u2
        for node, label in [("source_node1", "source_labels1"), ("source_node2", "source_labels2")]:
            node_id = record[node]["identity"]
            if node_id not in added_nodes:
                nodes.append({
                    "id": node_id,
                    "name": f"{node_id} ({record[node]['scene']})",
                    "category": record[label][0] if record[label] else "Unknown",
                    "symbolSize": 30  # èŠ‚ç‚¹å¤§å°ï¼Œå¯è°ƒæ•´
                })
                added_nodes.add(node_id)

        # å¤„ç†ç›®æ ‡èŠ‚ç‚¹ other1 å’Œ other2
        for target, label in [("target_node1", "target_labels1"), ("target_node2", "target_labels2")]:
            target_id = str(record[target])  # å‡è®¾ target_node æ²¡æœ‰æ˜ç¡® IDï¼Œç”¨æ•´ä¸ªå¯¹è±¡ä½œä¸ºæ ‡è¯†
            if target_id not in added_nodes:
                nodes.append({
                    "id": target_id,
                    "name": target_id,
                    "category": record[label][0] if record[label] else "Unknown",
                    "symbolSize": 20  # èŠ‚ç‚¹å¤§å°ï¼Œå¯è°ƒæ•´
                })
                added_nodes.add(target_id)

        # å¤„ç†å…³ç³» links
        for relation_list, source in [("relationships_from_u1", "source_node1"), ("relationships_from_u2", "source_node2")]:
            for relation in record[relation_list]:
                link_id = f"{record[source]['identity']}->{relation['type']}"
                if link_id not in added_links:
                    links.append({
                        "source": record[source]["user_id"],
                        "target": str(record[relation_list][0]),  # å‡è®¾å…³ç³»æŒ‡å‘äº† target
                        "value": relation["type"],  # å…³ç³»ç±»å‹
                        "lineStyle": {"type": "solid"}  # å®çº¿
                    })
                    added_links.add(link_id)

        # æ·»åŠ è™šæ‹Ÿå…³ç³»
        virtual_rel = record["virtual_relationship"]
        virtual_id = f"{virtual_rel['source']}->{virtual_rel['target']}"
        if virtual_id not in added_links:
            links.append({
                "source": virtual_rel["source"],
                "target": virtual_rel["target"],
                "value": virtual_rel["relationshipType"],
                "lineStyle": {"type": virtual_rel["style"]}  # è™šæ‹Ÿå…³ç³»æ ·å¼
            })
            added_links.add(virtual_id)

    return {"nodes": nodes, "links": links}

@api_show.route('/re_graph', methods=['GET'])
def get_re_graph():
    # æ¨¡æ‹Ÿå¤„ç†é€»è¾‘å¹¶è¿”å›
    query=''
    echart_data = process_to_echart_format(query)
    return jsonify(echart_data)




# çŸ¥è¯†å›¾è°±





def show_neo4j(query):
    config = configparser.ConfigParser()
    # åªä¾›æµ‹è¯•
    config.read('./setting/set.config')
    url = config.get('neo4j', 'url')
    driver = GraphDatabase.driver(url, auth=(config.get('neo4j', 'user'), config.get('neo4j', 'password')))
    # è¿æ¥åˆ°neo4jæ•°æ®åº“
    session = driver.session()
    # æ‰§è¡ŒæŸ¥è¯¢
    result = session.run(query)
    links = []
    nodes = []
    id=1
    s_id={}
    # å°†ç»“æœè½¬æ¢ä¸ºJSONæ ¼å¼
    for record in result:
        re = record.data()['p']
        print(re)
        obj = str(re)
        #print(obj)
        a = obj.split(",")[0].split(":")[1][2:-2]
        b = obj.split(",")[1][2:-1]
        c = obj.split(",")[2][:-2].split(":")[1].strip('}')[2:-1]
        d = obj.split(",")[2][:-2].split(":")[0].strip('{')[3:-1]
        if a in s_id:
            sid=s_id[a]
        else:
            sid=id
            s_id[a]=sid
            id=id+1
            n1 = {
                "id": f"{sid}",
                "name": a,
                "type": "user",
                "size": 16,
                "color": 1,
                "category":0
            }
            nodes.append(n1)
        if c in s_id:
            tid = s_id[c]
        else:
            tid = id
            s_id[c] = tid
            id = id + 1
            type=kind[dict[b]]["name"]
            n2 = {
                "id": f"{tid}",
                "name": c,
                "type": type,
                "size": 8,
                "color": 2,
                "category":dict[b]
            }
            nodes.append(n2)
        data = {
            "source": f"{sid}",
            "target": f"{tid}",
            "relation": b,
            "type":kind[dict[b]]["name"]
        }
        links.append(data)
    a = {"links": links, "nodes": nodes,"categories":kind}
    print("å…³ç³»:",len(links),"ä¸ª,èŠ‚ç‚¹:",len(nodes))

    # å…³é—­ä¼šè¯å’Œé©±åŠ¨ç¨‹åº
    session.close()
    driver.close()
    return a

def get_metric_result(query):
    config = configparser.ConfigParser()
    # åªä¾›æµ‹è¯• todo
    config.read('./setting/set.config')
    url = config.get('neo4j', 'url')
    driver = GraphDatabase.driver(url, auth=(config.get('neo4j', 'user'), config.get('neo4j', 'password')))
    # è¿æ¥åˆ°neo4jæ•°æ®åº“
    session = driver.session()
    # æ‰§è¡ŒæŸ¥è¯¢
    print(query)
    result = session.run(query)
    children=[]
    links=[]
    id=0
    for record in result:
        print(record.value)
        path = record['p']
        # è®¿é—®è·¯å¾„ä¸­çš„èŠ‚ç‚¹å’Œå…³ç³»
        nodes = list(path.nodes)
        relationships_in_path = list(path.relationships)
        
        # ç¡®ä¿è·¯å¾„ä¸­è‡³å°‘æœ‰ä¸€ä¸ªå…³ç³»
        if relationships_in_path:
            start_node = nodes[0]
            relationship = relationships_in_path[0]
            end_node = nodes[1]
            
            l = {
                "father": start_node._properties['name'],
                "father_desc": start_node._properties.get('desc', ''),
                "children": end_node._properties['name'],
                "children_desc": end_node._properties.get('desc', '')
            }
        # link=record.data()['p']
        # print(link)
        # f=link[0]['name']
        # f_d=link[0]['desc']
        # c=link[2]['name']
        # c_d=link[2]['desc']
        # l={
        #     "father":f,
        #     "father_desc":f_d,
        #     "children":c,
        #     "children_desc":c_d
        # }
        links.append(l)
    # åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ï¼Œç”¨äºå­˜å‚¨å­èŠ‚ç‚¹
    child_dict = {}
    # éå†å…³ç³»åˆ—è¡¨
    for relationship in links:
        parent = relationship['father']
        child = relationship['children']
        # å¦‚æœçˆ¶èŠ‚ç‚¹å·²ç»åœ¨å­—å…¸ä¸­ï¼Œå°†å­èŠ‚ç‚¹æ·»åŠ åˆ°è¯¥çˆ¶èŠ‚ç‚¹çš„åˆ—è¡¨ä¸­
        if parent not in child_dict:
            c = {
                'name': parent,
                'children': [
                    {'name': child, 'desc': relationship['children_desc']}
                ],
                'desc': relationship['father_desc']
            }
            child_dict[parent] = c
        # å¦‚æœçˆ¶èŠ‚ç‚¹ä¸åœ¨å­—å…¸ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨å¹¶å°†å­èŠ‚ç‚¹æ·»åŠ åˆ°å…¶ä¸­
        else:
            c = {
                'name': child,
                'desc': relationship['children_desc']
            }
            child_dict[parent]['children'].append(c)
    dict_list=list(child_dict.values())
    root={}
    for i in dict_list:
        if i['name']=='éšç§æ•ˆæœè¯„ä¼°æŒ‡æ ‡ä½“ç³»':
            print(i)
            root=i
    a=[]
    for i in root['children']:
        a.append(handle(i,child_dict))
    session.close()
    driver.close()
    data={
        'name': 'éšç§æ•ˆæœè¯„ä¼°æŒ‡æ ‡ä½“ç³»',
        'children': a,
        'desc':''
    }
    return data
def handle(dict,child_dict):
    if dict['name'] not in child_dict.keys():
        #print(dict['name'])
        ##è¯´æ˜æ˜¯æ ¹èŠ‚ç‚¹
        return dict
    l=[]
    for i in child_dict[dict['name']]['children']:
        l.append(handle(i,child_dict))
    a = {
        'name': dict['name'],
        'desc': dict['desc'],
        'children': l
    }
    return a